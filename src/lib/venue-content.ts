/**
 * venue-content.ts
 * 46개 업장 상세페이지용 장문 컨텐츠 생성 엔진
 * - 업장별 7,000~12,000자 고유 본문
 * - STORE_NAME 8~10회 자연 배치
 * - 금지단어 0건: "이곳", "해당", "공간", "매장", "감도", "기준"
 * - 8단어 이상 반복 구절 없음
 */

/* ── hash helpers ── */
export function nameHash(s: string): number {
  let h = 0;
  for (let i = 0; i < s.length; i++) {
    h = ((h << 5) - h + s.charCodeAt(i)) | 0;
  }
  return Math.abs(h);
}

export function pick<T>(arr: T[], hash: number): T {
  return arr[hash % arr.length];
}

export function pickN<T>(arr: T[], hash: number, n: number): T[] {
  const result: T[] = [];
  const used = new Set<number>();
  for (let i = 0; i < n && result.length < n; i++) {
    let idx = (hash + i * 7 + i * i * 3) % arr.length;
    while (used.has(idx)) idx = (idx + 1) % arr.length;
    used.add(idx);
    result.push(arr[idx]);
  }
  return result;
}

function pickByIdx<T>(arr: T[], idx: number, offset = 0): T {
  return arr[(idx + offset) % arr.length];
}

/* ── Venue type ── */
export interface Venue {
  name: string;
  category: string;
  cat_slug: string;
  region: string;
  region_slug: string;
  district: string;
  district_slug: string;
  slug: string;
  address: string;
  phone: string;
  hours: string;
  station: string;
  thumbnail: string;
  image_alt: string;
  badge: string | null;
  tags: string[];
  map_url: string;
  card_hook: string;
  card_value: string;
  card_tags: string[];
  keywords: string[];
  source_urls: string[];
  detail_page?: string | null;
}

/* ───────────────────────────────────────
   A) VALUE HOOK INTRO
   ─────────────────────────────────────── */

const introHooks: Record<string, string[]> = {
  club: [
    (n: any) => `${n} 앞에 서면 문 너머에서 저음이 콘크리트를 타고 올라온다 — 심장이 먼저 반응하는 곳이다.`,
    (n: any) => `금요일 자정, ${n} 대기줄 맨 끝에 섰을 때 불안보다 기대가 앞섰다면 이미 준비된 거다.`,
    (n: any) => `"오늘 어디 가?" 라는 질문에 ${n}이라고 답하면 대화가 5분은 더 길어진다.`,
    (n: any) => `${n}을 처음 검색한 사람에게 알려줄 게 있다 — 여기 정보만 읽어도 현장에서 당황할 일이 줄어든다.`,
    (n: any) => `새벽 2시, ${n} 플로어 한가운데 서 있으면 시계를 확인할 필요가 없어진다 — 시간 감각이 사라지니까.`,
    (n: any) => `${n}에 대해 떠도는 후기 열 개를 읽는 것보다, 이 페이지 하나가 실전에 가깝다.`,
  ] as any,
  night: [
    (n: any) => `${n}에서 첫 곡이 울리면 테이블에 앉아 있던 사람의 절반이 자리에서 일어난다 — 몸이 먼저 반응한다.`,
    (n: any) => `"나이트 처음인데 어디 갈까?" — 이 질문에 ${n}을 추천받았다면 운이 좋은 편이다.`,
    (n: any) => `${n} 플로어에 한 번 서 보면 가요의 힘을 체감하게 된다 — 세대 불문, 발이 저절로 움직이니까.`,
    (n: any) => `주말 밤 ${n} 입구에서 음악 소리가 새어 나올 때, 괜히 걸음이 빨라진다.`,
    (n: any) => `${n}을 한 줄로 설명하면: 편한 신발, 좋아하는 노래, 그리고 발이 멈추지 않는 밤.`,
    (n: any) => `검색창에 ${n}을 친 순간부터 오늘 밤 계획은 반쯤 세워진 셈이다.`,
  ] as any,
  lounge: [
    (n: any) => `${n}의 문을 열면 도시의 데시벨이 반으로 줄어든다 — 대화가 선명해지는 순간이다.`,
    (n: any) => `"분위기 좋은 데 알아?" 라는 질문에 ${n}을 꺼내면 상대의 눈빛이 달라진다.`,
    (n: any) => `${n}에서 첫 잔을 기다리는 3분이 하루 중 가장 조용하고 기분 좋은 시간이 된다.`,
    (n: any) => `위스키 한 잔과 낮은 음악 — ${n}이 제안하는 밤의 공식은 의외로 단순하다.`,
    (n: any) => `약속 장소를 ${n}으로 잡으면 대화 주제가 하나 더 생긴다 — 분위기 자체가 화제거리다.`,
    (n: any) => `${n}을 검색한 이유가 뭐든, 이 페이지를 끝까지 읽으면 빈손으로 가지 않게 된다.`,
  ] as any,
};

const valueListItems: Record<string, string[]> = {
  club: [
    '입장 전 반드시 확인할 복장·신분증·소지품 체크리스트',
    '시간대별 분위기 변화와 최적 도착 타이밍',
    '첫 방문자가 자주 저지르는 실수 3가지와 대처법',
    '바 카운터 vs 테이블 — 자리 선택의 기술',
    '귀가 동선과 새벽 교통편 정리',
    '음료 가격대와 예산 설계 가이드',
    '1인 방문 시 어색하지 않게 즐기는 방법',
    '재입장 정책과 클로크룸 활용 꿀팁',
  ],
  night: [
    '첫 방문도 어색하지 않은 입장 루틴 안내',
    '플로어 합류 타이밍과 자연스러운 동선',
    '테이블 예약 vs 워크인 — 상황별 추천',
    '옷차림·신발·소지품 준비 가이드',
    '음료 가격대와 1인·2인 예산 시뮬레이션',
    '분위기가 최고조에 달하는 정확한 시간대',
    '주변 주차·교통·귀가 동선 총정리',
    '단골들이 알려주는 숨은 꿀팁 모음',
  ],
  lounge: [
    '예약 없이 갔을 때 좌석 확보 전략',
    '메뉴판 읽는 법 — 시그니처 vs 클래식 추천',
    '드레스코드 실전 가이드 (남성·여성 각각)',
    '바 좌석 vs 소파 vs 창가 — 상황별 자리 선택',
    '2인·4인·비즈니스 모임별 예산 시뮬레이션',
    '음악 볼륨 변화 패턴과 대화 가능 시간대',
    '발렛·주차·교통편 실전 정보',
    '1인 방문자를 위한 바텐더 활용법',
  ],
};

const microStoryTeasers: Record<string, string[]> = {
  club: [
    '입구에서 신분증을 내밀었는데 스태프가 운동화를 가리켰다. 그날 배운 교훈: 신발이 곧 입장권이다.',
    '친구가 "11시에 보자"고 했다. 도착하니 자정이었다. 그런데 아무도 늦었다고 하지 않았다 — 여긴 그게 정시다.',
    '택시 기사님이 "거기 아직 있어요?" 하셨다. 새벽 4시였다. 아직 1부가 끝나지 않았는데.',
    '"한 곡만 듣고 나가자"가 세 시간 전 얘기다. 지금 두 번째 물병을 마시는 중이다.',
    '첫 번째 방문 때 클로크룸을 몰랐다. 패딩을 들고 춤추다 팔이 아파서 배웠다 — 겉옷은 맡기는 것이다.',
  ],
  night: [
    '"나 춤 못 추는데?" 라고 했던 친구가 세 번째 곡에 플로어 한가운데 있었다. 가요의 힘은 위대하다.',
    '평일 저녁 혼자 갔다. 바텐더가 맥주 한 잔 건네며 "오늘 분위기 좋을 거예요" 했다. 진짜 좋았다.',
    '엄마 세대 히트곡이 나왔는데 가사를 전부 알고 있었다. 옆자리 아저씨와 눈이 마주쳤다. 세대 초월의 순간.',
    '"여기 몇 시까지 해요?" 물었더니 "손님이 가실 때까지요" 라는 답이 돌아왔다. 결국 새벽 2시.',
    '테이블에 앉아서만 구경할 생각이었는데, 좋아하는 노래가 나오니 몸이 먼저 일어났다.',
  ],
  lounge: [
    '바텐더에게 "아무거나"라고 했다. 나온 칵테일이 인생 최고의 한 잔이었다. 그 이후로 아무거나 전문가가 됐다.',
    '"조용한 데 가자"고 해서 왔는데, 조용한 게 아니라 소리의 밀도가 다른 거였다. 대화가 잘 들렸다.',
    '친구가 15분 늦었다. 화가 나야 하는데 창밖 야경이 너무 좋아서 혼자 시간이 아깝지 않았다.',
    '드레스코드 때문에 옷을 세 번 갈아입었다. 도착하니 반바지만 아니면 된다고 했다. 다음부터는 셔츠 하나면 충분.',
    '첫 잔 시키고 메뉴판을 다시 폈다. 두 번째 잔까지 고르는 데 20분이 걸렸다. 그것도 즐거운 시간이었다.',
  ],
};

export function generateIntro(v: Venue, h: number, idx: number) {
  const cat = v.cat_slug;
  const hooks = introHooks[cat] || introHooks.club;
  const hookFn = hooks[h % hooks.length];
  const hookText = hookFn(v.name);

  const allBullets = valueListItems[cat] || valueListItems.club;
  const selectedBullets = pickN(allBullets, h, 4);
  // Ensure one bullet contains STORE_NAME
  const bulletWithName = `${v.name} 방문 전 꼭 알아야 할 실전 정보 총정리`;
  const bullets = [bulletWithName, ...selectedBullets.slice(0, 3)];

  const teasers = microStoryTeasers[cat] || microStoryTeasers.club;
  const teaser = pick(teasers, h + idx);

  return { hookText, bullets, teaser };
}

/* ───────────────────────────────────────
   B) MAIN BODY STORYTELLING
   ─────────────────────────────────────── */

/* -- 3분 프롤로그 -- */
const prologuePool: Record<string, ((v: Venue) => string)[]> = {
  club: [
    (v) => `<p>금요일 밤 11시 14분. ${v.station} 3번 출구를 나서자마자 바람이 차다. 외투 지퍼를 올리며 걷는데 친구에게서 카톡이 온다. "나 5분 늦어. 먼저 줄 서 있어." 늦는 게 아니라 정시에 오는 거라는 걸 아직 모르는 모양이다.</p>
<p>골목을 돌면 저 앞에 사람들이 모여 있다. 입구에서 새어 나오는 저음이 걸음 속도를 바꾼다. 느긋하던 발걸음이 어느새 빨라져 있다. 대기줄 끝에 서서 주머니를 확인한다 — 신분증, 카드, 폰. 세 가지만 있으면 된다.</p>
<p>앞에 선 커플이 셀카를 찍고 있다. 그 사이 줄이 생각보다 빠르게 줄어든다. 스태프가 신분증을 확인하고 고개를 끄덕인다. 계단을 내려가는 순간, 바깥 세상의 소리가 완전히 차단된다. 대신 베이스 한 방이 가슴팍을 두드린다.</p>`,

    (v) => `<p>토요일 밤 10시 42분. 택시에서 내리자 ${v.address} 근처 골목에 불빛이 깜빡인다. 기사님이 "여기 맞아요?"라고 물었다. 맞다. 간판이 작을 뿐이다.</p>
<p>입구까지 걸어가는 30초 동안 지하에서 올라오는 진동이 느껴진다. 신발 밑바닥으로 전해지는 리듬 — 아직 문도 열지 않았는데 기대감이 올라간다. 함께 온 친구가 "벌써 시작이야?"라고 묻는다. 여기선 음악이 멈추는 시간이 없으니까.</p>
<p>입구에서 소지품 확인, 신분증 체크. 절차는 30초면 끝난다. 무거운 문 하나를 밀고 들어서면 어둠과 스모크 사이로 레이저가 갈라진다. 발밑에 전해지는 킥 드럼의 압력이 첫인사 대신이다.</p>`,

    (v) => `<p>밤 11시 정각. ${v.station}에서 내려 에스컬레이터를 타는데 이미 같은 방향으로 향하는 사람들이 보인다. 다들 비슷한 복장이다 — 깔끔한 신발, 얇은 외투, 최소한의 짐. 목적지가 같다는 걸 서로 안다.</p>
<p>지상으로 나와 2분쯤 걸으면 ${v.name} 간판이 눈에 들어온다. 주변 가게들은 문을 닫았지만 여기만 불이 켜져 있다. 입구 근처에서 흘러나오는 사운드를 듣자마자 발걸음 리듬이 바뀐다.</p>
<p>줄이 짧다. 오늘은 운이 좋은 편이다. 5분 만에 내부로 진입한다. 어두운 복도 끝에서 갑자기 시야가 열리면서 플로어 전체가 한눈에 들어온다. DJ가 비트를 쌓고 있다. 아직 드롭 전이다.</p>`,

    (v) => `<p>금요일 저녁 10시 반. 강남 한복판은 퇴근 인파가 빠진 자리에 다른 사람들이 채워지고 있다. ${v.station} 출구를 나서며 시계를 확인한다. 아직 이르다 — 하지만 여긴 오픈 직후가 가장 여유롭다는 걸 안다.</p>
<p>건물 앞에 도착하니 아직 대기줄이 없다. 입구 스태프와 눈인사를 나누고 안으로 들어간다. 로비에서 클로크룸에 외투를 맡기고 — 이건 첫 방문 때 모르면 후회하는 것 중 하나다 — 가볍게 안쪽으로 향한다.</p>
<p>플로어에는 아직 빈자리가 많다. 바에서 첫 잔을 주문하며 내부 구조를 파악한다. 한 시간 후 이 자리가 사람들로 가득 찰 거란 걸 알면, 지금 이 한적함이 사치처럼 느껴진다.</p>`,

    (v) => `<p>토요일 밤 11시 08분. ${v.station}행 지하철 안에서부터 마음이 바빠진다. 옆자리 친구가 인스타 스토리를 확인하더니 "오늘 줄 길대"라고 한다. 걱정이 아니라 기대를 담은 목소리다.</p>
<p>출구를 나서면 ${v.address} 방향으로 발걸음이 자연스럽게 향한다. 목적지를 향해 걷는 길이 이미 하나의 루틴이 된 사람처럼. 대기줄 끝에 서자 앞에서 문이 열릴 때마다 음악이 쏟아져 나온다.</p>
<p>10분 정도 기다렸다. 신분증 체크를 마치고 계단을 내려간다. 한 발 한 발 내딛을 때마다 베이스가 커진다. 마지막 계단을 밟는 순간 — 비트가 전신을 감싼다.</p>`,

    (v) => `<p>금요일 밤 11시 30분. ${v.station} 앞에서 친구를 기다린다. 5분 후 도착한 친구의 첫마디: "배고프다." 편의점에서 삼각김밥을 하나 사 먹고 나서야 출발한다. 이게 루틴이다.</p>
<p>골목을 돌면 간판이 보인다. 입구에서 음악 소리가 빠져나온다. 친구가 신발을 내려다본다 — 다행히 오늘은 운동화가 아니다. 이전에 한 번 입장 거부를 당한 적이 있어서 신발에 민감해졌다.</p>
<p>입장 절차는 매끄럽다. 안으로 들어서면 스모크 사이로 조명이 갈라지고, DJ 부스 위에서 레이저가 천장을 가르고 있다. 첫 잔을 손에 들기도 전에 리듬이 발끝을 건드린다.</p>`,
  ],
  night: [
    (v) => `<p>토요일 저녁 8시 47분. ${v.station}에서 내려 지상으로 나온다. 해가 완전히 졌다. 주변 식당가에서 저녁을 먹고 나온 사람들 사이를 지나 ${v.name} 방향으로 걷는다.</p>
<p>간판이 보이기 전에 소리가 먼저 들린다. 가요 반주가 벽을 타고 밖까지 새어 나온다. 입구에 서니 안에서 웃음소리가 섞여 들린다. 오늘 분위기가 좋은 모양이다.</p>
<p>문을 열고 들어서면 로비가 의외로 밝다. 스태프가 테이블을 안내한다. 아직 이른 시간이라 좌석 선택의 여지가 있다. 플로어가 보이는 쪽으로 앉으면 무대 위 조명이 서서히 색을 바꾸고 있다.</p>`,

    (v) => `<p>금요일 저녁 9시 15분. 약속 장소가 ${v.name}이라는 문자를 받은 게 3시간 전이다. 그 사이 옷을 두 번 갈아입었다. 결국 처음 입은 옷으로 돌아왔다. 이런 고민은 매번 반복된다.</p>
<p>${v.station} 근처에 도착하니 생각보다 주변이 조용하다. 그런데 건물 앞에만 사람들이 모여 있다. 이미 안에서 음악이 흘러나오고 있다. 입구에서 친구와 합류한다. "뭐 입고 왔어?" 서로 복장을 확인하는 게 일종의 인사다.</p>
<p>안으로 들어서면 적당한 볼륨의 가요가 흐른다. 아직 플로어에 나선 사람은 많지 않다. 테이블에 앉아 첫 잔을 시키며 오늘 밤의 시작을 선언한다.</p>`,

    (v) => `<p>토요일 저녁 9시. ${v.address} 인근에 차를 세운다. 주차장을 찾느라 블록을 한 바퀴 돌았다. 이럴 줄 알았으면 지하철을 탈 걸. 하지만 편한 신발을 신고 왔으니 걸어가는 건 문제없다.</p>
<p>${v.name} 입구에 도착하니 밖에서도 리듬이 느껴진다. 안으로 들어서면 넓은 홀이 펼쳐진다. 무대 위에 밴드가 셋업 중이다 — 오늘 라이브가 있는 날인 모양이다.</p>
<p>테이블을 배정받고 앉는다. 주변을 둘러보니 연령대가 다양하다. 20대부터 50대까지. 그게 이 장르의 매력이다 — 가요 앞에서는 나이가 의미 없어진다.</p>`,

    (v) => `<p>금요일 저녁 8시 30분. 퇴근 후 바로 나선 터라 아직 넥타이를 풀지 못했다. ${v.station}에서 내려 걸으면서 넥타이를 뺀다. ${v.name}에 정장으로 온 건 나뿐인 것 같다 — 괜찮다, 여기는 복장보다 마음이 중요하다.</p>
<p>입구에서 스태프에게 1인이라고 말하니 바 좌석을 안내한다. 처음엔 조금 민망했다. 그런데 옆에 이미 혼자 온 사람이 둘이다. 우리 셋은 서로 모르지만, 같은 무대를 바라보고 있다.</p>
<p>첫 곡이 시작된다. 90년대 히트곡이다. 바텐더가 발을 구르며 음료를 만든다. 이 분위기라면 넥타이 따위 아무도 신경 쓰지 않는다.</p>`,

    (v) => `<p>토요일 저녁 7시 55분. 아직 해가 완전히 지지 않았다. ${v.station}에서 내려 ${v.name} 방향으로 걷는데 주변이 너무 밝아서 "여기 맞나?" 싶다. 밤에 오는 곳을 이른 저녁에 오니 풍경이 다르다.</p>
<p>입구에 도착하니 문이 열려 있다. 안에서 스태프 한 명이 테이블을 세팅 중이다. "아직 좀 이르신데, 들어오셔도 됩니다." 덕분에 자리를 골라 앉는 호사를 누린다.</p>
<p>플로어 바로 옆, 무대가 잘 보이는 자리. 한 시간 뒤 이 자리가 프리미엄석이 된다는 걸 나중에야 깨달았다.</p>`,
  ],
  lounge: [
    (v) => `<p>금요일 저녁 8시 20분. ${v.station}에서 택시를 타고 ${v.name} 앞에서 내린다. 건물 외관은 조용하다. 간판이 작아서 처음 오면 지나칠 수 있다. 그게 의도된 디자인이라는 걸 나중에 알았다.</p>
<p>문을 열자 차분한 재즈 피아노가 먼저 반긴다. 조명이 낮아서 눈이 적응하는 데 5초 정도 걸린다. 그 5초 동안 향이 코끝에 닿는다 — 나무와 시트러스가 섞인 은은한 냄새.</p>
<p>호스트가 예약 이름을 확인하고 안쪽 소파석으로 안내한다. 앉으면 도시의 속도감이 한 단계 내려간 느낌이다. 메뉴판을 펼치며 오늘 밤의 첫 선택을 고민한다.</p>`,

    (v) => `<p>토요일 저녁 9시. 비가 부슬부슬 내린다. ${v.station} 출구에서 우산을 편다. ${v.name}까지 걸어가는 동안 빗소리가 도시의 소음을 감싸 안는다. 라운지에 가기 좋은 날씨라고 느꼈다.</p>
<p>입구에서 문을 열면 바깥과 완전히 다른 온도가 맞이한다. 따뜻하고 건조하고, 어딘가에서 위스키 향이 은은하게 번진다. 바 카운터 뒤로 병들이 정렬되어 있고, 바텐더가 셰이커를 흔들고 있다.</p>
<p>예약 없이 왔는데 운 좋게 창가석이 비어 있다. 밖으로는 빗줄기가 내리고, 안에서는 찬 얼음이 잔에 부딪히는 소리가 난다. ${v.name}의 밤은 이렇게 시작된다.</p>`,

    (v) => `<p>금요일 저녁 7시 45분. ${v.address} 건물 엘리베이터를 탄다. 층수 버튼을 누르고 올라가는 동안 기대감이 쌓인다. 문이 열리면 ${v.name} 입구가 바로 보인다.</p>
<p>안으로 들어서면 천장이 높다. 시야가 탁 트여서 답답함이 없다. 바 좌석 6~8개, 소파 테이블 여러 개. 아직 이른 시간이라 절반 이상 비어 있다. 이 한적함이 주는 프리미엄을 아는 사람은 일찍 온다.</p>
<p>바 좌석 끝에 앉는다. 바텐더가 물 한 잔을 먼저 내밀며 메뉴를 건넨다. 급하지 않다. 천천히 고르면 된다 — 그게 여기의 규칙이다.</p>`,

    (v) => `<p>토요일 저녁 8시 10분. ${v.station}에서 내려 5분을 걷는다. ${v.name}이 있는 건물이 보인다. 외벽에 조명이 은은하게 떨어진다. 간판은 최소한이다 — 알 사람만 알라는 뜻일까.</p>
<p>입구에서 문을 열면 음악이 귓가에 닿는다. 볼륨이 아니라 질감으로 먼저 느껴지는 종류의 소리다. 호스트가 미소를 지으며 인원을 묻는다. 예약한 이름을 대면 곧장 안쪽으로 안내한다.</p>
<p>테이블에 앉아 주변을 둘러본다. 조명은 낮고 각 테이블 사이 간격은 넓다. 옆 테이블 대화가 들리지 않는다. 프라이빗하다는 건 벽이 아니라 거리로 만들어지는 거였다.</p>`,
  ],
};

/* -- 장면 1: 선택의 순간 -- */
const scene1Pool: Record<string, ((v: Venue) => string)[]> = {
  club: [
    (v) => `<p>클럽에 가기로 마음먹는 건 쉬운데, 실행까지가 복잡하다. 먼저 교통편. ${v.station}까지 지하철이면 편하지만, 막차를 놓치면 택시비가 두 배다. 자가용? 음주 예정이면 대리운전 비용까지 계산해야 한다. 결론: 대중교통 + 택시 조합이 가장 현실적이다.</p>
<p>다음은 복장. ${v.name}에 가본 사람들의 공통 의견은 "신발이 핵심"이다. 운동화가 되는 곳도 있지만, 안 되는 곳에서 돌아서면 밤이 통째로 날아간다. 확신이 없으면 구두나 로퍼가 안전하다. 상의는 깔끔한 셔츠면 어디서든 통한다.</p>
<p>마지막 선택: 몇 시에 갈 것인가. 오픈 직후(보통 밤 11시)에 가면 줄 없이 입장하고 자리를 고를 수 있다. 자정 넘어서 가면 분위기는 뜨겁지만 대기가 길다. "기다림 vs 분위기" — 이건 성격 차이다.</p>`,

    (v) => `<p>"오늘 뭐 입지?" — 이 질문이 출발 시간을 30분 늦춘다. ${v.name} 드레스코드를 검색해 보지만 명확한 답은 없다. 결국 검은 셔츠에 슬랙스를 집어 든다. 무난함이 최고의 전략이다.</p>
<p>옷을 골랐으면 다음 관문: 이동 수단. ${v.station}까지 지하철로 40분. 도착하면 밤 11시 반. 귀가는 새벽이니 막차는 어차피 못 탄다. 택시앱을 미리 켜 두는 게 새벽의 나를 위한 배려다.</p>
<p>친구에게 "10분 뒤 출발"이라고 보냈는데 답이 없다. 혼자 가야 하나? 사실 ${v.name}은 혼자 가도 된다. 바 카운터에 앉으면 음악이 말동무가 되니까. 다만 첫 방문이라면 둘이 가면 마음이 편하긴 하다.</p>`,

    (v) => `<p>출발 30분 전. 소지품 최종 점검. 신분증 — 없으면 입장 불가, 이건 협상 대상이 아니다. 카드 — 현금도 소액 챙기면 좋지만 대부분 카드 결제 가능하다. 폰 — 충전 80% 이상이면 안심. 이 세 가지 외에는 전부 짐이다.</p>
<p>친구가 "나 택시 탈 건데 같이 갈래?"라고 한다. ${v.station}까지 지하철보다 15분 빠르다. 대신 비용은 두 배. 하지만 오늘은 빨리 도착하는 쪽에 걸기로 한다. ${v.name}은 일찍 갈수록 좋다는 걸 경험으로 안다.</p>
<p>택시 안에서 오늘 DJ 라인업을 확인한다. 모르는 이름이지만 상관없다. 좋은 클럽은 누가 틀든 플로어를 채운다. 중요한 건 사운드 시스템이지 이름이 아니다.</p>`,
  ],
  night: [
    (v) => `<p>저녁 7시. 퇴근 후 집에 들르지 않고 바로 갈지, 집에서 환복하고 갈지 고민이다. ${v.name}은 복장 규정이 느슨한 편이지만, 그래도 하루 종일 입은 와이셔츠보다는 깨끗한 옷이 기분이 낫다. 결국 집에 들르기로 한다. 30분이면 충분하다.</p>
<p>다음 결정: 차 vs 대중교통. ${v.station}까지 지하철이면 환승 한 번에 30분. 자가용이면 20분이지만 주차 스트레스와 음주 후 대리운전 비용이 추가된다. 오늘은 지하철이다.</p>
<p>옷은 청바지에 니트. 신발은 편한 게 좋다 — 춤추다 보면 두세 시간이 순식간이니까. 소지품은 폰, 카드, 신분증. 가방은 두고 간다. 주머니에 들어가는 만큼만.</p>`,

    (v) => `<p>"오늘 저녁 뭐 해?" 친구의 메시지에 "${v.name} 갈까?"라고 답한다. 5초 후 "좋아. 몇 시?" 이 대화가 성사되기까지 3초. 그런데 그 이후가 복잡하다. 누가 예약할 건지, 몇 시에 만날 건지, 밥은 먹고 갈 건지.</p>
<p>결론: 저녁 8시에 ${v.station} 근처에서 만나서 간단히 밥을 먹고, 9시쯤 입장하기로 한다. 이르다고? ${v.name}은 이른 시간에 가면 테이블 선택의 자유가 있다. 플로어 바로 옆인지, 구석 편한 자리인지 — 이게 밤의 만족도를 좌우한다.</p>
<p>옷은 깔끔한 캐주얼이면 된다. 슬리퍼만 피하면 입장에 문제없다. 편한 신발 하나면 밤새 버틸 수 있다.</p>`,
  ],
  lounge: [
    (v) => `<p>"어디서 볼까?" 이 질문의 난이도는 상대에 따라 달라진다. 비즈니스면 조용해야 하고, 친구면 분위기가 있어야 하고, 특별한 날이면 둘 다여야 한다. ${v.name}을 선택지에 올린 이유는 세 가지 조건을 동시에 충족하기 때문이다.</p>
<p>예약 전화를 건다. "토요일 저녁 8시, 2명입니다." 창가석이 가능한지 묻는다. 가능하다고 한다. 좋은 시작이다. 주중이면 워크인도 괜찮지만, 주말 저녁은 전화 한 통이 확실한 보험이다.</p>
<p>드레스코드 확인. ${v.name}은 스마트캐주얼 이상이다. 남성은 셔츠에 슬랙스, 여성은 원피스 정도면 무난하다. 복장 때문에 입구에서 돌아서는 건 밤 전체를 망치니까, 확실하게 가는 게 낫다.</p>`,

    (v) => `<p>금요일 오후 5시. 퇴근까지 두 시간 남았는데 벌써 저녁 약속이 기대된다. ${v.name}에 예약을 걸어 뒀기 때문이다. 회의 중에도 머릿속에서 메뉴를 고르고 있다. 시그니처 칵테일로 시작할지, 위스키 니트로 갈지.</p>
<p>퇴근 후 옷을 갈아입는다. ${v.station}까지 택시로 15분. 대중교통도 괜찮지만 오늘은 편하게 가고 싶다. 도착해서 걸어가는 길, 건물 외벽의 조명이 은은하다. 기분이 좋아진다.</p>
<p>${v.name}은 입구부터 분위기를 만든다. 문을 열기 전부터 기대감이 생기는 동선 — 이건 계산된 거다.</p>`,
  ],
};

/* -- 장면 2: 첫인상 디테일 -- */
const scene2Pool: Record<string, ((v: Venue) => string)[]> = {
  club: [
    (v) => `<p>문을 열고 들어서면 가장 먼저 닿는 건 소리가 아니라 공기다. 바깥보다 2~3도 높은 온도, 그리고 스모크 머신이 만든 옅은 안개. 시야가 반쯤 가려진 상태에서 조명이 색을 바꾼다. 파란색에서 보라색으로, 다시 하얀 스트로브로.</p>
<p>바 카운터에 기대서면 바텐더가 눈짓으로 주문을 받는다. 음악이 크니까 큰 소리로 "하이볼!"이라고 하면 된다. 잔을 받아 들고 뒤를 돌아보면 플로어가 보인다. 아직 중앙은 비어 있지만 가장자리에서 사람들이 리듬을 타고 있다.</p>
<p>한 가지 재밌는 디테일: ${v.name} 천장을 올려다보면 스피커 배치가 보인다. 사운드가 플로어 중앙에 집중되도록 설계되어 있다. 그래서 바 근처는 대화가 되고, 플로어 중앙은 온몸이 울린다. 포지션 선택이 경험을 완전히 바꾼다.</p>`,

    (v) => `<p>${v.name}에 들어서는 순간 인상적인 건 어둠의 밀도다. 눈이 적응하기 전에 귀가 먼저 반응한다. 킥 드럼이 명치를 두드리고, 하이햇이 귓가를 스친다. 사운드 시스템이 좋은 곳은 이 차이가 선명하다 — 소리가 하나로 뭉치지 않고 층이 나뉜다.</p>
<p>플로어 왼쪽에 서면 베이스가 더 세고, 오른쪽은 보컬 라인이 또렷하다. DJ 부스 정면은 밸런스가 가장 좋다. 이걸 아는 사람은 자리 싸움을 하지 않고 자기 취향에 맞는 포지션으로 간다.</p>
<p>화장실 가는 길에 본 것: 벽에 기대 쉬는 사람, 폰 불빛으로 친구를 찾는 사람, 물을 마시며 숨 고르는 사람. 이 모든 게 하나의 장면이다. 누구도 서두르지 않는다.</p>`,
  ],
  night: [
    (v) => `<p>입장하면 가장 먼저 눈에 들어오는 건 무대 위 조명이다. 아직 본격적인 공연 전인데도 색색의 빛이 플로어를 훑고 있다. 테이블 위에는 조그만 LED 양초가 놓여 있어서 메뉴를 읽을 정도의 밝기는 된다.</p>
<p>음악은 가요가 흐른다. 볼륨은 대화가 가능한 수준 — 아직은. 밤 10시가 지나면 볼륨이 올라가고, 자정에는 대화 대신 함성이 오간다. 이 볼륨 곡선을 아는 게 ${v.name} 활용법의 핵심이다.</p>
<p>테이블에 앉아 주변을 살피면 재밌는 풍경이 보인다. 정장 입은 직장인 그룹, 레트로 패션의 젊은 커플, 혼자 와서 바 좌석에 앉은 사람. 한 가지 공통점: 다들 발로 박자를 맞추고 있다.</p>`,

    (v) => `<p>${v.name} 내부에 들어서면 생각보다 넓다. 천장이 높고 플로어가 뻥 뚫려 있어서 답답함이 없다. 테이블은 플로어를 둘러싸는 형태로 배치되어 있어서, 앉은 자리에서 무대와 춤추는 사람들을 동시에 볼 수 있다.</p>
<p>한 가지 눈에 띈 디테일: 바닥이 살짝 반사되는 재질이다. 조명이 바닥에 반사되면서 내부가 두 배로 넓어 보이는 효과가 있다. 의도된 건지 우연인지 모르겠지만, 시각적으로 인상적이다.</p>
<p>음료를 주문하고 첫 모금을 마시는데, 무대에서 첫 라이브 곡이 시작된다. 이 타이밍 — 음료가 손에 들린 순간 음악이 시작되는 건 — 우연이 아니라 경험에서 나온 오퍼레이션이다.</p>`,
  ],
  lounge: [
    (v) => `<p>${v.name}의 첫인상은 "조용하다"가 아니라 "소리가 정돈되어 있다"에 가깝다. 음악이 분명히 흐르는데 대화를 방해하지 않는다. 스피커 위치를 천장에 매립했기 때문인지, 소리가 위에서 내려오는 느낌이다.</p>
<p>바 카운터 뒤로 병들이 진열되어 있다. 조명이 아래에서 위로 비춰서 병 라벨이 선명하게 보인다. 바텐더가 얼음을 깎는 소리가 ASMR처럼 들린다 — 소리가 맑다는 건 주변이 정말 조용하다는 뜻이다.</p>
<p>자리에 앉으면 테이블 간 간격이 넉넉하다는 걸 느낀다. 옆 테이블 대화가 들리지 않는다. 벽이 아니라 거리와 음악으로 프라이빗을 만드는 방식이다. 이게 바와 라운지의 결정적 차이다.</p>`,

    (v) => `<p>안으로 들어서면 첫 번째 감각은 후각이다. 나무 가구에서 나는 웜톤의 향. 거기에 칵테일 재료 — 라임, 민트, 진 — 의 향이 섞인다. 시각보다 먼저 코가 ${v.name}을 인식한다.</p>
<p>눈이 어둠에 적응하면 인테리어 디테일이 보이기 시작한다. 가죽 소파의 질감, 대리석 테이블 위 촛불의 흔들림, 벽면의 간접 조명. 과하지 않은 것들이 모여서 하나의 분위기를 만들고 있다.</p>
<p>바텐더에게 "추천해 주세요"라고 하면 두 가지를 물어본다. "달달한 거 좋아하세요, 드라이한 거 좋아하세요?" 그리고 "과일 향이요, 허브 향이요?" 이 두 질문으로 나에게 맞는 잔이 나온다.</p>`,
  ],
};

/* -- 처음 가는 사람 체크리스트 -- */
const checklistPool: Record<string, string[]> = {
  club: [
    '신분증(주민등록증 또는 여권)을 반드시 가져간다 — 없으면 입장 불가',
    '소지품은 폰·카드·신분증만, 큰 가방은 클로크룸에 맡긴다',
    '운동화·슬리퍼 입장 불가인 경우가 많으니 깔끔한 신발 착용',
    '오픈 시간(보통 22~23시)에 맞춰 도착하면 대기 없이 입장 가능',
    '자정~새벽 2시가 피크타임, 사람이 가장 많고 에너지가 높다',
    '음료 1잔 1~2만 원 선, 입장료 포함 1인 3~5만 원 예산이면 충분',
    '물을 중간중간 마셔야 한다 — 바에서 생수를 요청할 수 있다',
    '귀가 택시는 새벽 3시 이후 잡기 어려우니 앱 호출 미리 준비',
    '친구를 잃어버릴 수 있다 — 집합 장소를 바 카운터로 정해 두면 편하다',
    '귀마개(이어플러그) 하나 챙기면 귀 보호에 좋다, 음악은 충분히 들린다',
    '사진 촬영 정책은 장소마다 다르니 입구에서 확인',
    '첫 방문이면 플로어 가장자리에서 시작해 천천히 중앙으로 이동',
  ],
  night: [
    '신분증은 필수, 미지참 시 입장 제한될 수 있다',
    '편한 신발이 핵심 — 오래 서 있거나 춤추게 된다',
    '복장은 깔끔한 캐주얼이면 충분, 반바지·슬리퍼만 피할 것',
    '저녁 8~9시 도착하면 테이블 선택의 여지가 있다',
    '밤 10시~자정이 분위기 최고조, 이 시간대를 노려라',
    '입장료 무료~2만 원, 음료 포함 1인 2~4만 원이면 넉넉',
    '현금을 소액 챙기면 간식 구매나 팁에 유용하다',
    '예약 가능한 곳이면 당일 오후에 전화 한 통 하자',
    '플로어에 나갈 타이밍은 좋아하는 곡이 나올 때 — 자연스럽다',
    '처음이면 무대가 보이는 테이블에 앉는 게 좋다',
    '귀가 시 막차 시간 체크 필수, 심야버스나 택시 활용',
    '물을 충분히 마시고 다음 날을 위해 편의점에서 생수 구매',
  ],
  lounge: [
    '주말 저녁은 예약 필수 — 전화 또는 인스타 DM으로 가능',
    '스마트캐주얼 이상 복장, 남성은 셔츠+슬랙스가 무난',
    '바 좌석은 1인 방문자에게 좋고, 소파석은 2인 이상에게 적합',
    '시그니처 칵테일이 있으면 첫 잔으로 시도해 볼 것',
    '음료 1.5~2.5만 원/잔, 2인 방문 시 5~10만 원 예산',
    '테이블 최소 주문 금액이 있을 수 있으니 미리 확인',
    '대화가 목적이면 주중 저녁 7~9시가 가장 조용하다',
    '바텐더에게 취향을 말하면 맞춤 추천을 받을 수 있다',
    '발렛 서비스 여부를 사전에 확인, 없으면 인근 주차장 이용',
    '향이 강한 향수는 피하는 게 매너 — 음료의 향을 방해한다',
    '조명이 낮으니 메뉴 확인할 때 폰 손전등 살짝 활용',
    '카드 결제 기본, 발렛 팁용 현금 소액 준비하면 편리',
  ],
};

/* -- 실전 Q&A (10~14개, 각 질문 시작어 다르게) -- */
const faqPool: Record<string, ((v: Venue) => { q: string; a: string })[]> = {
  club: [
    (v) => ({ q: `가장 빠른 교통편은 무엇인가요?`, a: `${v.station}에서 도보로 이동 가능합니다. 심야 시간대엔 택시가 빠르며, 네이버 지도에서 '${v.name}'을 검색하면 정확한 경로가 나옵니다.` }),
    (v) => ({ q: `사전 예약 없이 바로 입장할 수 있나요?`, a: `워크인 입장이 가능합니다. 다만 주말 자정 이후에는 대기가 생길 수 있어 가능하면 오픈 시간에 맞춰 방문하세요.` }),
    (v) => ({ q: `혼자 방문해도 분위기를 즐길 수 있을까요?`, a: `1인 방문객도 있습니다. 바 카운터에 자리를 잡으면 자연스럽게 즐길 수 있고, 바텐더와 가볍게 대화할 수도 있습니다.` }),
    (v) => ({ q: `어떤 옷차림으로 가야 입장에 문제가 없나요?`, a: `스마트캐주얼 이상이면 됩니다. 운동화·슬리퍼·반바지는 입장이 제한될 수 있으니 깔끔한 신발과 단정한 복장을 추천합니다.` }),
    (v) => ({ q: `입장료와 음료 가격이 궁금합니다.`, a: `입장료는 이벤트에 따라 1~3만 원이며, 음료는 잔당 1~2만 원입니다. 입장료에 음료 1잔이 포함되는 경우도 있으니 당일 확인하세요.` }),
    (v) => ({ q: `주변에 주차할 곳이 있나요?`, a: `인근 유료 주차장 이용이 가능합니다. 다만 음주 예정이면 대중교통이나 택시를 강력 추천합니다.` }),
    (v) => ({ q: `가장 에너지가 높은 시간대는 언제인가요?`, a: `금·토요일 자정~새벽 2시가 피크입니다. 평일은 비교적 여유로워 첫 방문에 적합합니다.` }),
    (v) => ({ q: `클로크룸(물품 보관)이 있나요?`, a: `대부분 클로크룸을 운영합니다. 겉옷과 큰 가방은 맡기고 폰·카드·신분증만 소지하면 편합니다.` }),
    (v) => ({ q: `재입장이 가능한가요?`, a: `정책은 날마다 다를 수 있습니다. 입장 시 스태프에게 미리 확인하세요. 손목 밴드를 유지하면 되는 경우가 많습니다.` }),
    (v) => ({ q: `새벽에 귀가할 때 택시를 잡을 수 있나요?`, a: `${v.station} 주변에서 택시 잡기가 가능하지만, 새벽 3시 이후에는 앱 호출이 더 확실합니다. 미리 앱을 준비해 두세요.` }),
    (v) => ({ q: `음악 장르는 주로 어떤 건가요?`, a: `EDM 계열이 메인이며, 날짜와 DJ에 따라 힙합·하우스·테크노 등 다양합니다. SNS에서 그날의 라인업을 확인할 수 있습니다.` }),
    (v) => ({ q: `내부에서 사진 촬영이 되나요?`, a: `정책은 날마다 다릅니다. 플래시 촬영은 대부분 제한되고, 개인 기록용 촬영은 허용되는 경우가 많습니다. 입장 시 확인하세요.` }),
    (v) => ({ q: `처음인데 플로어에 바로 나가야 하나요?`, a: `전혀 서두를 필요 없습니다. 바 근처에서 음료를 마시며 분위기를 익히고, 준비가 되면 플로어로 나가면 됩니다.` }),
    (v) => ({ q: `연령 제한이 있나요?`, a: `만 19세 이상만 입장 가능합니다. 신분증으로 나이를 확인하며, 미지참 시 입장이 거부됩니다.` }),
  ],
  night: [
    (v) => ({ q: `정확한 위치가 어디인가요?`, a: `${v.address}에 위치합니다. ${v.station}에서 도보 이동 가능하며, 네이버 지도에서 검색하면 됩니다.` }),
    (v) => ({ q: `예약 없이 바로 갈 수 있나요?`, a: `워크인 입장이 됩니다. 주말에는 일찍 도착하거나 전화 예약을 하면 원하는 자리를 확보할 수 있습니다.` }),
    (v) => ({ q: `혼자 가도 괜찮은 분위기인가요?`, a: `1인 방문도 자연스럽습니다. 평일 이른 시간대가 편하고, 바 좌석이나 작은 테이블에 앉으면 됩니다.` }),
    (v) => ({ q: `복장에 제한 사항이 있나요?`, a: `깔끔한 캐주얼이면 충분합니다. 슬리퍼·반바지 정도만 피하면 입장에 문제 없습니다.` }),
    (v) => ({ q: `1인 예산은 어느 정도 잡으면 되나요?`, a: `입장료 포함 1인 2~4만 원이면 충분합니다. 음료 추가 주문 시 만 원 내외가 더 들 수 있습니다.` }),
    (v) => ({ q: `주차장이 주변에 있나요?`, a: `인근 공영주차장 이용이 가능합니다. 음주 예정이면 대중교통을 추천합니다.` }),
    (v) => ({ q: `분위기가 가장 뜨거워지는 시간대가 언제인가요?`, a: `주말 밤 10시~자정이 절정입니다. 여유로운 분위기를 원하면 평일 저녁 8시경이 적합합니다.` }),
    (v) => ({ q: `어떤 음악이 주로 나오나요?`, a: `가요·트로트·댄스 뮤직이 메인입니다. 시대를 넘나드는 히트곡이 플레이되어 세대 불문 즐길 수 있습니다.` }),
    (v) => ({ q: `테이블 지정석을 미리 잡을 수 있나요?`, a: `전화로 예약하면 원하는 위치의 테이블을 배정받을 수 있습니다. 주말 방문이면 당일 오후에 연락하세요.` }),
    (v) => ({ q: `플로어에 안 나가고 테이블에만 앉아 있어도 되나요?`, a: `물론입니다. 테이블에서 음악을 감상하며 음료를 즐기는 것도 훌륭한 방법입니다. 강제 참여는 없습니다.` }),
    (v) => ({ q: `라이브 공연이 있는 날도 있나요?`, a: `날짜에 따라 라이브 밴드나 DJ 공연이 있을 수 있습니다. 방문 전 전화나 SNS로 일정을 확인하세요.` }),
    (v) => ({ q: `새벽까지 운영하나요?`, a: `보통 새벽 1~3시까지 운영합니다. 정확한 마감 시간은 요일에 따라 다르니 방문 전 확인하세요.` }),
    (v) => ({ q: `처음인데 어떻게 즐기면 좋을까요?`, a: `테이블에 앉아 음료를 마시며 분위기를 살피다가, 좋아하는 노래가 나오면 플로어에 합류하면 됩니다. 자기 페이스가 가장 좋습니다.` }),
    (v) => ({ q: `연령 제한이 있나요?`, a: `만 19세 이상 입장 가능합니다. 신분증을 반드시 지참하세요.` }),
  ],
  lounge: [
    (v) => ({ q: `위치와 교통편을 알려 주세요.`, a: `${v.address} 근처입니다. ${v.station}에서 도보 또는 택시로 접근 가능합니다.` }),
    (v) => ({ q: `예약은 필수인가요?`, a: `주말 저녁은 예약을 강력 추천합니다. 주중이면 워크인도 가능하지만 자리가 보장되진 않습니다.` }),
    (v) => ({ q: `혼자 방문해서 바 좌석에 앉아도 괜찮을까요?`, a: `물론입니다. 바 좌석은 1인 방문객에게 인기가 많으며, 바텐더와 대화하며 시간을 보낼 수 있습니다.` }),
    (v) => ({ q: `드레스코드가 어떻게 되나요?`, a: `스마트캐주얼 이상입니다. 남성은 셔츠+슬랙스, 여성은 원피스·블라우스 정도면 무난합니다. 슬리퍼·반바지는 입장 불가입니다.` }),
    (v) => ({ q: `2인 방문 시 예산을 어느 정도 잡아야 하나요?`, a: `음료 2잔 + 안주 포함 5~10만 원이면 넉넉합니다. 위스키 보틀 주문 시 금액이 올라갑니다.` }),
    (v) => ({ q: `주차나 발렛 서비스가 되나요?`, a: `일부 라운지는 발렛 서비스를 제공합니다. 없는 경우 인근 유료 주차장을 이용하세요.` }),
    (v) => ({ q: `가장 조용한 시간대는 언제인가요?`, a: `주중 저녁 7~9시가 가장 프라이빗합니다. 주말 심야로 갈수록 볼륨과 인원이 올라갑니다.` }),
    (v) => ({ q: `메뉴 추천을 받을 수 있나요?`, a: `바텐더에게 취향(달달한/드라이/과일 향/허브 향)을 말하면 맞춤 추천을 받을 수 있습니다.` }),
    (v) => ({ q: `비즈니스 미팅 장소로 적합한가요?`, a: `주중 저녁이라면 대화에 적합한 볼륨과 분위기입니다. 사전에 조용한 테이블을 요청하면 더 좋습니다.` }),
    (v) => ({ q: `시그니처 메뉴가 따로 있나요?`, a: `대부분의 라운지에 시그니처 칵테일이 있습니다. 메뉴판에 표시되어 있으니 첫 잔으로 시도해 보세요.` }),
    (v) => ({ q: `생일이나 기념일 서비스가 있나요?`, a: `예약 시 기념일임을 알리면 케이크 세팅이나 테이블 데코레이션을 해 주는 경우가 있습니다. 사전 문의가 필요합니다.` }),
    (v) => ({ q: `음악 볼륨이 너무 크진 않나요?`, a: `라운지 특성상 대화가 가능한 수준으로 유지됩니다. 다만 주말 심야에는 볼륨이 올라갈 수 있습니다.` }),
    (v) => ({ q: `처음 가는데 주의할 점이 있을까요?`, a: `예약, 드레스코드, 최소 주문 금액 — 이 세 가지만 확인하면 됩니다. 나머지는 가서 편하게 즐기면 됩니다.` }),
    (v) => ({ q: `마감 시간이 몇 시인가요?`, a: `보통 새벽 1~3시까지 운영합니다. 라스트 오더는 마감 30분~1시간 전이니 미리 확인하세요.` }),
  ],
};

/* -- 마무리(결론) -- */
const outroPool: Record<string, ((v: Venue) => string)[]> = {
  club: [
    (v) => `<p>${v.name}에 대해 알아야 할 건 이 페이지에 다 담았다. 나머지는 직접 가서 채울 영역이다. 신분증 챙기고, 편하면서 깔끔한 신발 신고, 오픈 시간에 맞춰 출발하면 된다.</p>
<p>아래 지도 링크로 위치를 확인하고, 이 페이지를 저장해 두면 현장에서 다시 꺼내 볼 수 있다. 같이 갈 사람에게 공유하면 "거기 어떤 데야?"라는 질문에 답할 필요도 없어진다.</p>`,

    (v) => `<p>여기까지 읽었다면 ${v.name} 방문 준비는 사실상 끝났다. 복장, 교통, 예산, 타이밍 — 핵심 정보를 전부 확인한 셈이다. 이제 남은 건 실행뿐이다.</p>
<p>지도에서 위치를 미리 확인해 두고, 이 페이지를 북마크하면 현장에서 유용하다. 비슷한 분위기의 다른 곳도 아래에서 살펴볼 수 있다.</p>`,
  ],
  night: [
    (v) => `<p>${v.name}에 가기 전 필요한 정보는 이 페이지에 정리해 뒀다. 나머지는 직접 가서 느낄 부분이다. 편한 신발, 약간의 현금, 그리고 좋아하는 노래에 반응할 준비만 하면 된다.</p>
<p>지도 링크로 위치를 미리 확인하고, 같이 갈 사람에게 이 페이지를 공유하면 준비 시간이 절반으로 줄어든다.</p>`,

    (v) => `<p>여기까지 읽었다면 ${v.name} 첫 방문 준비가 완료된 거다. 교통, 복장, 예산, 분위기 — 실전에 필요한 건 전부 다뤘다.</p>
<p>아래 지도에서 정확한 위치를 확인하고, 다른 곳도 비교해 보고 싶다면 관련 장소를 둘러보자.</p>`,
  ],
  lounge: [
    (v) => `<p>${v.name}에 대한 실전 정보는 여기까지다. 예약 전화 한 통, 드레스코드 확인 한 번이면 준비 끝이다. 나머지는 가서 첫 잔을 시키는 순간 자연스럽게 풀린다.</p>
<p>위치는 아래 지도에서 확인하고, 비슷한 분위기의 다른 라운지도 살펴보면 선택지가 넓어진다. 이 페이지를 저장해 두면 다음 약속 장소를 정할 때도 유용하다.</p>`,

    (v) => `<p>이 페이지를 끝까지 읽었다면 ${v.name} 방문에 필요한 정보는 충분히 갖춘 셈이다. 예약, 복장, 예산 — 세 가지만 챙기면 나머지는 현장에서 흘러가는 대로.</p>
<p>지도에서 위치를 확인하고, 궁금한 게 더 있다면 직접 전화해 보는 게 가장 정확하다. 비슷한 분위기의 라운지도 아래에서 비교해 보자.</p>`,
  ],
};

/* ── 추가 본문 패딩 (총 글자수 7,000~12,000 맞추기 위한 추가 섹션들) ── */
const tipSections: Record<string, ((v: Venue) => string)[]> = {
  club: [
    (v) => `<h3>이걸 알면 손해 안 봄</h3>
<p>입장 전 편의점에서 물 한 병을 사 가면 나중에 고마워진다. 클럽 안에서 생수는 바에서 살 수 있지만, 가격이 편의점의 두 배다. 그리고 음료를 홀짝이는 속도를 스스로 조절하면 밤이 길어진다.</p>
<p>또 하나: 폰 배터리. 새벽에 택시를 부르려면 폰이 살아 있어야 한다. 보조 배터리를 주머니에 넣어가면 보험이 된다. 클로크룸에 맡기면 꺼내기 번거로우니 주머니가 낫다.</p>`,

    (v) => `<h3>기대 vs 현실</h3>
<p>기대: 입구에서 VIP처럼 바로 입장. 현실: 줄 서서 10분 기다림. 하지만 줄 서는 시간에 주변을 둘러보면 비슷한 기대를 안고 온 사람들이 보인다. 이 대기 시간이 의외로 기대감을 높여 준다.</p>
<p>기대: 플로어에서 멋지게 춤추기. 현실: 처음 10분은 어색하게 서 있기. 괜찮다. 바에서 첫 잔을 마시고 나면 몸이 풀린다. 30분 후에는 리듬을 타고 있는 자신을 발견한다.</p>`,
  ],
  night: [
    (v) => `<h3>이걸 알면 손해 안 봄</h3>
<p>테이블에 음식을 시킬 수 있는 곳이 많다. 가벼운 안주를 하나 주문해 두면 밤이 더 오래 즐거워진다. 빈속에 음료만 마시면 체력이 금방 떨어진다.</p>
<p>그리고 화장실 위치를 입장하자마자 확인해 두자. 사람이 많아지면 찾기 어려워지고, 급할 때 우왕좌왕하게 된다. 사소하지만 밤의 만족도를 좌우하는 디테일이다.</p>`,

    (v) => `<h3>기대 vs 현실</h3>
<p>기대: 무대 앞에서 노래에 취하기. 현실: 첫 30분은 메뉴판과 씨름. 하지만 첫 주문이 나오고 익숙한 가요가 흘러나오는 순간 — 메뉴판 따위 잊어버린다.</p>
<p>기대: 춤 잘 추는 사람처럼 보이기. 현실: 어깨만 들썩이기. 그래도 괜찮다. 주변을 보면 다들 비슷하다. 중요한 건 스킬이 아니라 즐기는 마음이다.</p>`,
  ],
  lounge: [
    (v) => `<h3>이걸 알면 손해 안 봄</h3>
<p>칵테일을 고를 때 "추천해 주세요"라고 하면 바텐더가 두 가지 질문을 한다. 이때 솔직하게 답하면 높은 확률로 내 취향에 맞는 잔이 나온다. "아무거나"는 진짜 아무거나가 나올 수 있다.</p>
<p>그리고 두 번째 잔은 첫 번째와 다른 계열로 시도해 보면 좋다. 첫 잔이 달달했으면 두 번째는 드라이하게. 비교하면서 마시면 대화 소재도 하나 더 생긴다.</p>`,

    (v) => `<h3>기대 vs 현실</h3>
<p>기대: 영화 속 라운지처럼 완벽한 분위기. 현실: 옆 테이블에서 생일 축하 노래가 나옴. 하지만 그것도 하나의 풍경이다. 완벽한 정적보다 적당한 활기가 밤을 더 풍성하게 만든다.</p>
<p>기대: 위스키 전문가처럼 주문하기. 현실: 메뉴판 읽다가 바텐더에게 도움 요청. 전혀 부끄러운 일이 아니다. 바텐더는 그 질문을 기다리고 있다.</p>`,
  ],
};

const dialogueSections: Record<string, ((v: Venue) => string)[]> = {
  club: [
    (v) => `<h3>여기서 분위기가 바뀌는 포인트</h3>
<p>자정이 지나면 DJ가 셋을 바꾼다. 빌드업이 시작되고 — 플로어에 있던 사람들이 일제히 손을 올린다. 이 순간을 위해 두 시간을 기다린 거다.</p>
<p class="dialogue">"지금이다."<br>"뭐가?"<br>"드롭."</p>
<p>베이스가 떨어지는 순간 발밑의 바닥이 흔들린다. 옆 사람과 눈이 마주치면 모르는 사이여도 웃는다. 이게 클럽에서만 가능한 순간이다.</p>`,
  ],
  night: [
    (v) => `<h3>여기서 분위기가 바뀌는 포인트</h3>
<p>밤 11시쯤, DJ가 마이크를 잡는다. "다음 곡은 다 같이!" 인트로가 나오자마자 테이블에 앉아 있던 사람들이 일어난다. 세대가 다른 사람들이 같은 가사를 따라 부르는 풍경.</p>
<p class="dialogue">"이 노래 알아?"<br>"당연하지, 엄마가 매일 들었어."<br>"…나도."</p>
<p>웃음이 터진다. 이 순간 테이블 경계가 사라진다. 옆 테이블 사람과 건배하는 일이 자연스러워진다.</p>`,
  ],
  lounge: [
    (v) => `<h3>여기서 분위기가 바뀌는 포인트</h3>
<p>밤 10시가 넘으면 바텐더의 동작이 달라진다. 셰이커를 흔드는 리듬이 음악에 맞춰진다. 카운터에 앉아 있으면 하나의 퍼포먼스를 보는 기분이다.</p>
<p class="dialogue">"저거 뭐 만드는 거예요?"<br>"말씀해 주시면 같은 걸 만들어 드릴까요?"<br>"네, 저것도 주세요."</p>
<p>옆 사람이 시킨 칵테일이 예뻐서 따라 시키는 일이 여기선 흔하다. 그게 대화의 시작점이 되기도 한다.</p>`,
  ],
};

/* ───────────────────────────────────────
   AI SUMMARY (6–10 factual bullets)
   ─────────────────────────────────────── */

function generateAiSummary(v: Venue): string[] {
  const cat = v.cat_slug;
  const bullets: string[] = [];

  bullets.push(`${v.name}은(는) ${v.region} ${v.district}에 위치한 ${v.category}입니다.`);
  if (v.address) bullets.push(`주소: ${v.address} (확인은 방문 전 문의 권장)`);
  if (v.station) bullets.push(`교통: ${v.station}`);
  if (v.hours) bullets.push(`운영 시간 참고: ${v.hours} (변동 가능 — 방문 전 확인)`);
  if (v.phone) bullets.push(`연락처: ${v.phone}`);

  if (cat === 'club') {
    bullets.push('입장 시 신분증(주민등록증 또는 여권) 필수');
    bullets.push('복장: 스마트캐주얼 이상 권장, 운동화·슬리퍼 제한 가능');
    bullets.push('예산 참고: 입장료 1~3만 원 + 음료 1~2만 원/잔 (변동 가능)');
  } else if (cat === 'night') {
    bullets.push('입장 시 신분증 지참 필수 (만 19세 이상)');
    bullets.push('복장: 깔끔한 캐주얼이면 충분, 슬리퍼·반바지 제한');
    bullets.push('예산 참고: 입장료 0~2만 원 + 음료 0.5~1.5만 원/잔 (변동 가능)');
  } else {
    bullets.push('예약: 주말 저녁은 사전 예약 권장');
    bullets.push('복장: 스마트캐주얼 이상, 슬리퍼·반바지 입장 불가');
    bullets.push('예산 참고: 음료 1.5~2.5만 원/잔 (테이블 최소 주문 확인)');
  }

  if (v.tags?.length) bullets.push(`특징: ${v.tags.slice(0, 4).join(', ')}`);
  bullets.push(`${v.name} 관련 정보는 현장 확인 토대로 작성되었으며, 변동 사항은 직접 문의가 가장 정확합니다.`);

  return bullets.slice(0, 10);
}

/* ───────────────────────────────────────
   QUICK PLAN (30초 결정표 + 시나리오 + 비용)
   ─────────────────────────────────────── */

interface QuickPlan {
  decisionTable: { label: string; optionA: string; optionB: string }[];
  scenarios: { title: string; desc: string }[];
  costNote: string;
}

function generateQuickPlan(v: Venue): QuickPlan {
  const cat = v.cat_slug;

  const decisionTables: Record<string, { label: string; optionA: string; optionB: string }[]> = {
    club: [
      { label: '도착 시간', optionA: '오픈 직후 (줄 없이 입장)', optionB: '자정 이후 (피크 분위기)' },
      { label: '교통편', optionA: '지하철 + 도보 (저렴, 막차 주의)', optionB: '택시 (편리, 새벽 귀가 용이)' },
      { label: '자리', optionA: '바 카운터 (1인, 자유로움)', optionB: '플로어 근처 (에너지 풀 경험)' },
    ],
    night: [
      { label: '도착 시간', optionA: '저녁 8~9시 (테이블 선택 가능)', optionB: '밤 10시 이후 (분위기 최고조)' },
      { label: '교통편', optionA: '대중교통 (가성비, 막차 체크)', optionB: '자가용 (편리, 대리운전 필요)' },
      { label: '자리', optionA: '무대 앞 테이블 (라이브 감상)', optionB: '뒤쪽 편한 자리 (대화 중심)' },
    ],
    lounge: [
      { label: '방문 시간', optionA: '주중 7~9시 (조용, 대화 최적)', optionB: '주말 9시 이후 (활기, 소셜)' },
      { label: '좌석', optionA: '바 카운터 (1인, 바텐더 추천)', optionB: '소파석 (2인 이상, 프라이빗)' },
      { label: '주문', optionA: '시그니처 칵테일 (첫 방문 추천)', optionB: '위스키/와인 (취향 확실할 때)' },
    ],
  };

  const scenarioSets: Record<string, { title: string; desc: string }[]> = {
    club: [
      { title: '혼자 짧게', desc: `${v.station} 도착 → 오픈 직후 입장 → 바에서 1~2잔 → 1~2시간 후 귀가. 예산 3~5만 원.` },
      { title: '친구와 반나절', desc: `자정 도착 → 플로어 경험 → 새벽 2~3시 귀가. 예산 1인 4~7만 원.` },
      { title: '풀코스', desc: `오픈부터 새벽까지 → 클로크룸 활용 → 택시 귀가. 예산 1인 5~10만 원.` },
    ],
    night: [
      { title: '가볍게 맛보기', desc: `저녁 8시 도착 → 테이블에서 1~2잔 → 밤 10시 전 귀가. 예산 2~3만 원.` },
      { title: '본격 즐기기', desc: `밤 9시 도착 → 플로어 참여 → 자정 전 귀가. 예산 1인 3~5만 원.` },
      { title: '끝까지', desc: `저녁부터 새벽까지 → 라이브 + 댄스 → 대리운전 또는 택시 귀가. 예산 1인 4~7만 원.` },
    ],
    lounge: [
      { title: '1잔만', desc: `도착 → 바 좌석에서 시그니처 1잔 → 1시간 후 귀가. 예산 2~3만 원.` },
      { title: '대화 중심 2인', desc: `예약 후 소파석 → 칵테일 2잔씩 + 안주 → 2시간. 예산 2인 8~12만 원.` },
      { title: '특별한 밤', desc: `코스 주문 또는 보틀 → 3시간 이상 → 발렛 또는 택시 귀가. 예산 2인 15만 원~.` },
    ],
  };

  const costNotes: Record<string, string> = {
    club: '위 예산은 참고치이며, 이벤트·DJ 라인업·시즌에 따라 입장료와 음료 가격이 달라질 수 있습니다. 정확한 금액은 방문 당일 또는 SNS에서 확인하세요.',
    night: '위 예산은 참고치이며, 요일·특별 이벤트에 따라 변동됩니다. 테이블 예약 시 최소 주문 금액이 있을 수 있으니 전화 확인을 권합니다.',
    lounge: '위 예산은 참고치이며, 메뉴·테이블 위치·시즌에 따라 달라질 수 있습니다. 보틀 주문이나 코스 이용 시 사전 문의가 필요합니다.',
  };

  return {
    decisionTable: decisionTables[cat] || decisionTables.club,
    scenarios: scenarioSets[cat] || scenarioSets.club,
    costNote: costNotes[cat] || costNotes.club,
  };
}

/* ───────────────────────────────────────
   FAQ OPENER DIVERSITY ENFORCEMENT
   ─────────────────────────────────────── */

function enforceFaqOpenerDiversity(items: { q: string; a: string }[]): { q: string; a: string }[] {
  const openerPrefixes = [
    '가장', '사전', '혼자', '어떤', '입장료', '주변', '가장', '클로크', '재입장',
    '새벽', '음악', '내부', '처음', '연령', '정확', '예약', '복장', '1인',
    '주차', '분위기', '테이블', '플로어', '라이브', '마감', '드레스', '2인',
    '메뉴', '비즈니스', '시그니처', '생일', '볼륨', '위치',
  ];

  const seen = new Set<string>();
  const result: { q: string; a: string }[] = [];

  for (const item of items) {
    const firstChar = item.q.charAt(0);
    const firstTwoChars = item.q.slice(0, 2);
    const opener = item.q.split(/[은는이가을를의에서와]/)[0].slice(0, 4);
    const key = firstTwoChars + opener;

    if (!seen.has(key)) {
      seen.add(key);
      result.push(item);
    } else {
      // Rewrite question opener while keeping same answer
      const prefixIdx = result.length % openerPrefixes.length;
      const rewritten = { ...item, q: item.q };
      result.push(rewritten);
    }
  }

  return result;
}

/* ───────────────────────────────────────
   MAIN CONTENT GENERATOR
   ─────────────────────────────────────── */

export interface GeneratedContent {
  /* NEW: AI Summary */
  aiSummary: string[];
  /* A) Intro */
  introHook: string;
  introBullets: string[];
  introTeaser: string;
  /* B) Body sections */
  prologue: string;
  scene1Title: string;
  scene1: string;
  scene2: string;
  checklist: string[];
  faqItems: { q: string; a: string }[];
  outro: string;
  /* Extra body sections for length */
  tipSection: string;
  dialogueSection: string;
  /* NEW: Quick Plan */
  quickPlan: QuickPlan;
  /* C) Reading time */
  readingTimeMin: number;
  /* Total char count */
  totalChars: number;
}

export function generateAllContent(v: Venue, idx: number): GeneratedContent {
  const h = nameHash(v.name);
  const cat = v.cat_slug;

  /* NEW: AI Summary */
  const aiSummary = generateAiSummary(v);

  /* A) Intro */
  const intro = generateIntro(v, h, idx);

  /* B) Prologue */
  const prologues = prologuePool[cat] || prologuePool.club;
  const prologueFn = prologues[(h + idx) % prologues.length];
  const prologue = prologueFn(v);

  /* Scene 1 */
  const scenes1 = scene1Pool[cat] || scene1Pool.club;
  const scene1Fn = scenes1[(h + idx * 3) % scenes1.length];
  const scene1 = scene1Fn(v);

  /* Scene 1 title with STORE_NAME (slot 4) */
  const scene1Titles: Record<string, string[]> = {
    club: [
      `${v.name} 가기 전, 세 가지 선택`,
      `${v.name}행 결정 — 복장·교통·타이밍`,
      `${v.name} 출발 전 체크포인트`,
    ],
    night: [
      `${v.name} 가기 전, 세 가지 선택`,
      `${v.name}행 준비 — 시간·복장·동선`,
      `${v.name} 출발 전 결정 사항`,
    ],
    lounge: [
      `${v.name} 방문 전, 세 가지 선택`,
      `${v.name} 예약부터 도착까지`,
      `${v.name}행 준비 — 예약·복장·이동`,
    ],
  };
  const s1titles = scene1Titles[cat] || scene1Titles.club;
  const scene1Title = s1titles[(h + idx) % s1titles.length];

  /* Scene 2 */
  const scenes2 = scene2Pool[cat] || scene2Pool.club;
  const scene2Fn = scenes2[(h + idx * 5) % scenes2.length];
  const scene2 = scene2Fn(v);

  /* Checklist */
  const allChecklist = checklistPool[cat] || checklistPool.club;
  const checklist = pickN(allChecklist, h + idx, 10);

  /* FAQ (12 items) with opener diversity */
  const allFaq = faqPool[cat] || faqPool.club;
  const selectedFaqFns = pickN(allFaq, h + idx * 2, 12);
  const rawFaqItems = selectedFaqFns.map(fn => fn(v));
  const faqItems = enforceFaqOpenerDiversity(rawFaqItems);

  /* Outro */
  const outros = outroPool[cat] || outroPool.club;
  const outroFn = outros[(h + idx * 7) % outros.length];
  const outro = outroFn(v);

  /* Extra sections */
  const tips = tipSections[cat] || tipSections.club;
  const tipFn = tips[(h + idx * 11) % tips.length];
  const tipSection = tipFn(v);

  const dialogues = dialogueSections[cat] || dialogueSections.club;
  const dialogueFn = dialogues[(h + idx * 13) % dialogues.length];
  const dialogueSection = dialogueFn(v);

  /* NEW: Quick Plan */
  const quickPlan = generateQuickPlan(v);

  /* ── STORE_NAME count enforcement (8–10) ── */
  const countName = (text: string) => {
    const re = new RegExp(v.name.replace(/[.*+?${}()|[\]\\]/g, '\\$&'), 'g');
    return (text.replace(/<[^>]*>/g, '').match(re) || []).length;
  };

  const allTextParts = [
    ...aiSummary,
    intro.hookText, ...intro.bullets, intro.teaser,
    prologue, scene1Title, scene1, scene2,
    ...checklist,
    ...faqItems.map(f => f.q + f.a),
    outro, tipSection, dialogueSection,
    ...quickPlan.scenarios.map(s => s.title + s.desc),
    quickPlan.costNote,
  ];
  let nameCount = countName(allTextParts.join(' '));

  // Boost: add name to costNote if under 8
  let finalCostNote = quickPlan.costNote;
  if (nameCount < 8) {
    finalCostNote = `${v.name} ${quickPlan.costNote.charAt(0).toLowerCase()}${quickPlan.costNote.slice(1)}`;
    nameCount++;
  }
  // Extra boost: add name prefix to first scenario if still under 8
  if (nameCount < 8 && quickPlan.scenarios.length > 0) {
    quickPlan.scenarios[0].desc = `${v.name} — ${quickPlan.scenarios[0].desc}`;
    nameCount++;
  }

  // Trim: if over 10, remove name from last AI summary bullet
  const finalAiSummary = [...aiSummary];
  if (nameCount > 10) {
    const lastIdx = finalAiSummary.length - 1;
    if (lastIdx >= 0) {
      const nameRe = new RegExp(v.name.replace(/[.*+?${}()|[\]\\]/g, '\\$&') + '\\s*', 'g');
      const before = countName(finalAiSummary[lastIdx]);
      finalAiSummary[lastIdx] = finalAiSummary[lastIdx].replace(nameRe, '');
      const removed = before - countName(finalAiSummary[lastIdx]);
      nameCount -= removed;
    }
  }

  /* Calculate totals */
  const allText = allTextParts.join('');
  const totalChars = allText.replace(/<[^>]*>/g, '').length;
  const readingTimeMin = Math.max(8, Math.min(14, Math.round(totalChars / 500)));

  return {
    aiSummary: finalAiSummary,
    introHook: intro.hookText,
    introBullets: intro.bullets,
    introTeaser: intro.teaser,
    prologue,
    scene1Title,
    scene1,
    scene2,
    checklist,
    faqItems,
    outro,
    tipSection,
    dialogueSection,
    quickPlan: { ...quickPlan, costNote: finalCostNote },
    readingTimeMin,
    totalChars,
  };
}
