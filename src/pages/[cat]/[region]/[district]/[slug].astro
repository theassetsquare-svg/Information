---
import BaseLayout from '../../../../layouts/BaseLayout.astro';
import FAQ from '../../../../components/FAQ.astro';
import TrustBlock from '../../../../components/TrustBlock.astro';
import venuesData from '../../../../data/venues.json';
import { generateAllContent, hookTitles, hookDescs } from '../../../../lib/venue-content';
import type { Venue } from '../../../../lib/venue-content-types';
import { dedupeVenuePathParams, venueDetailPath } from '../../../../lib/slug-utils';

/* ───────── getStaticPaths ───────── */
export function getStaticPaths() {
  return venuesData
    .filter((v: any) => !v.detail_page)
    .map((v: any) => {
      const dd = dedupeVenuePathParams(v.cat_slug, v.region_slug, v.district_slug, v.slug);
      return {
        params: {
          cat: v.cat_slug,
          region: v.region_slug,
          district: dd.district,
          slug: dd.slug,
        },
        props: { venue: v },
      };
    });
}

/* ───────── props & content gen ───────── */
const { venue } = Astro.props as { venue: Venue };
const idx = venuesData.findIndex((v: any) => v.slug === venue.slug);
const content = generateAllContent(venue, idx);

/* ───────── helpers ───────── */
const catLabel = venue.category;
const catEn = venue.cat_slug;
const regionLabel = venue.region;
const siteUrl = 'https://informationa.pages.dev';
const pageUrl = `${siteUrl}${venueDetailPath(venue)}`;
const catFullLabel = catLabel === '클럽' ? '클럽' : catLabel === '나이트' ? '나이트' : '라운지';

/* Thumbnail */
const thumbPath = venue.thumbnail || '/images/og-thumb.jpg';
const thumbAbsolute = thumbPath.startsWith('http') ? thumbPath : `${siteUrl}${thumbPath}`;
const thumbAlt = `${venue.name} ${regionLabel} ${venue.district} ${catFullLabel} — 내부 분위기와 인테리어`;
const thumbWebp = thumbPath.replace(/\.(png|jpe?g)$/i, '.webp');
const hasWebpThumb = thumbWebp !== thumbPath;

/* Map URL: use venue.map_url if available, else Google Maps search fallback */
const mapUrl = venue.map_url || `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(venue.name + ' ' + regionLabel)}`;

/* Last updated date */
const lastUpdated = '2026.02.21';

/* Hero tagline — per-venue unique from JSON */
const heroTag = content.heroTagline || '밤의 에너지를 온몸으로 느끼다';

/* Related venues */
const relatedVenues = venuesData
  .filter((v: any) => v.slug !== venue.slug && (v.category === venue.category || v.region === venue.region))
  .slice(0, 4);

/* SEO */
const hookTitle = hookTitles[venue.slug] || '';
const title = hookTitle
  ? `${venue.name} — ${hookTitle}`
  : `${venue.name} | ${regionLabel} ${venue.district} ${catFullLabel} 완전 가이드`;
const stationShort = venue.station ? venue.station.split(',')[0].trim() : '';
const hookDesc = hookDescs[venue.slug] || '';
const description = hookDesc || (() => {
  const tagStr = venue.tags?.length ? venue.tags.slice(0, 3).join('·') : '';
  const meetWord = catEn === 'club' ? '헌팅' : catEn === 'night' ? '부킹' : '만남';
  const hooks = [
    `${venue.name} — 괜찮은 사람 만나려면 타이밍이 전부다. ${regionLabel} ${venue.district} ${catFullLabel}${tagStr ? ' · ' + tagStr : ''} — 이성 비율·${meetWord} 분위기·피크타임 정리.`,
    `${venue.name} — 여기서 ${meetWord} 성공하려면 자리 선택부터 다르다. ${regionLabel} ${venue.district} ${catFullLabel}${tagStr ? ' · ' + tagStr : ''} — 현장 경험 토대로 정리.`,
    `${venue.name} — 혼자 가도 만남이 되는 곳인가? 솔직하게 답한다. ${regionLabel} ${venue.district} ${catFullLabel}${tagStr ? ' · ' + tagStr : ''} — ${meetWord} 분위기·남녀 비율 가이드.`,
    `${venue.name} — ${meetWord} 잘 되는 시간대를 모르면 헛걸음이다. ${regionLabel} ${venue.district} ${catFullLabel}${tagStr ? ' · ' + tagStr : ''} — 시간대별 분위기 분석.`,
    `${venue.name} — 마음에 드는 사람을 만날 확률이 가장 높은 곳. ${regionLabel} ${venue.district} ${catFullLabel}${tagStr ? ' · ' + tagStr : ''} — ${meetWord} 팁·분위기·이성 비율.`,
    `${venue.name} — 장소 선택이 오늘 밤 만남을 결정한다. ${regionLabel} ${venue.district} ${catFullLabel}${tagStr ? ' · ' + tagStr : ''} — ${meetWord} 성공 노하우 정리.`,
    `${venue.name} — 여기 갈 거면 이성 비율 확인부터. ${regionLabel} ${venue.district} ${catFullLabel}${tagStr ? ' · ' + tagStr : ''} — 피크타임·${meetWord} 분위기·현장 가이드.`,
    `${venue.name} — 만남이 목적이라면 이 한 페이지로 충분하다. ${regionLabel} ${venue.district} ${catFullLabel}${tagStr ? ' · ' + tagStr : ''} — ${meetWord}·분위기·타이밍 정리.`,
  ];
  const descRaw = hooks[idx % hooks.length];
  return descRaw.length > 155 ? descRaw.slice(0, 152) + '...' : descRaw;
})();

/* Keywords meta */
const baseKeywords = venue.keywords || [];
const extraKeywords = [
  venue.name,
  `${regionLabel} ${catFullLabel}`,
  `${venue.district} ${catFullLabel}`,
  `${venue.name} 위치`,
  `${venue.name} 영업시간`,
  `${venue.name} 입장료`,
  `${venue.name} 후기`,
  `${regionLabel} ${venue.district} ${catFullLabel} 추천`,
  stationShort ? `${stationShort} ${catFullLabel}` : '',
].filter(Boolean);
const allKeywords = [...new Set([...baseKeywords, ...extraKeywords])].join(',');

/* Article meta for Naver freshness signals */
const publishedTime = '2025-12-01T00:00:00+09:00';
const modifiedTime = new Date().toISOString();

/* Practical guide rows — per-venue label variants */
const guideLabels = [
  ['운영시간', '영업 시간대', '오픈·마감', '이용 가능 시간', '문 여는 시간', '운영 스케줄', '시간 참고', '오픈 일정'],
  ['위치 / 교통', '주소 · 교통편', '찾아오는 길', '접근 경로', '소재지 참고', '이동 방법', '교통 요약', '오시는 길'],
  ['예약 / 입장', '사전 준비', '입장 절차', '출입 절차', '예약 방법', '입장 방식', '방문 절차', '출입 참고'],
  ['복장 / 분위기', '착장 참고', '옷차림 가이드', '분위기 힌트', '스타일 참고', '복장 팁', '착장 팁', '분위기 참고'],
  ['예산 감각', '비용 참고', '지출 범위', '예상 경비', '가격 수준', '예산 참고', '비용 요약', '지출 가이드'],
];
const guideRows = [
  { label: guideLabels[0][idx % 8], value: venue.hours || '확인 필요 — 방문 전 전화 문의 권장' },
  { label: guideLabels[1][idx % 8], value: `${venue.address} · ${venue.station}` },
  { label: guideLabels[2][idx % 8], value: catEn === 'lounge'
    ? ['사전 예약 권장 · 워크인 시 대기 가능','예약 후 방문이 편리 · 현장 접수도 가능','미리 자리를 잡아두면 안심 · 당일 방문도 가능','예약 우선 · 빈 자리 있으면 현장 입장 가능','자리 확보를 위해 예약 권장 · 빈 석이 있으면 가능','사전 연락 후 방문 추천 · 워크인 대기 발생 가능','좌석 예약이 유리 · 현장 대기도 가능하다','미리 확인 후 방문이 좋다 · 예약 없이도 가능'][idx % 8]
    : catEn === 'club'
    ? ['신분증 필수 · 주말은 사전 예약 유리','공식 증빙서류 확인 · 주말 사전 등록 권장','입구 신원확인 있음 · 주말 예약이 유리','본인확인 필수 · 주말 방문 시 사전 등록','증빙서류 지참 · 주말은 미리 등록하면 편리','입장 시 서류 확인 · 주말 사전 접수 추천','출입 전 확인 절차 있음 · 주말 등록 추천','증빙 지참 후 입장 · 주말은 사전 접수가 빠르다'][idx % 8]
    : ['워크인 가능 · 주말 저녁은 일찍 도착 권장','현장 입장 가능 · 주말은 서두르는 편이 좋다','사전 등록 없이 입장 · 주말은 이른 도착 추천','별도 예약 없이 방문 가능 · 주말은 조기 입장 권장','현장 접수로 입장 · 주말 저녁은 빨리 가야 여유','예약 없이 방문 OK · 주말 피크는 일찍 와야 편리','당일 방문 환영 · 주말에는 서두르는 게 좋다','바로 입장 가능 · 주말에는 오픈 시간 맞춰 도착'][idx % 8] },
  { label: guideLabels[3][idx % 8], value: catEn === 'club'
    ? ['스마트캐주얼 이상 · 운동화 제한 가능','깔끔한 복장 권장 · 슬리퍼 입장 불가','단정한 차림 기본 · 운동복은 어려움','정돈된 옷차림 · 편한 신발도 깔끔하면 OK','복장 확인 있음 · 트레이닝은 입장 불가','입구에서 착장 체크 · 기본 이상이면 무난','드레스코드 있음 · 단정하면 통과','착장 기준 존재 · 깔끔하면 문제없음'][idx % 8]
    : catEn === 'lounge'
    ? ['스마트캐주얼 이상 · 슬리퍼/반바지 불가','깔끔한 복장 필수 · 캐주얼 이하 제한','단정한 착장 권장 · 운동복은 피해야 함','정돈된 스타일 · 편의복은 입장 어려움','복장 수준 확인 · 비치웨어류 불가','착장 기준 엄격 · 기본 이상 차림 필요','드레스코드 존재 · 슬리퍼와 반바지 제외','스마트한 착장 기본 · 과도한 캐주얼 제한'][idx % 8]
    : ['깔끔한 캐주얼 · 슬리퍼만 피하면 OK','편안하되 단정한 옷 · 슬리퍼만 아니면 됨','기본 캐주얼 · 너무 편한 차림만 피하면 충분','자유로운 복장 · 슬리퍼류만 제한','복장 제한 거의 없음 · 최소한의 단정함만','편한 옷 OK · 비치웨어만 피하면 됨','캐주얼 환영 · 지나치게 편한 차림만 주의','자유로운 착장 · 트레이닝복은 피하는 게 좋다'][idx % 8] },
  { label: guideLabels[4][idx % 8], value: catEn === 'club'
    ? ['입장료 1~3만 원 + 음료 1~2만 원/잔','커버 1~3만 · 드링크 1~2만/잔','입장 비용 만~삼만 원대 · 음료 별도','도어차지 약 1~3만 · 음료 1잔 1~2만 원','입장비 1만~3만 선 · 드링크 추가 1~2만','출입료 1~3만 원 · 음료 한 잔 1~2만 원대','입장 1~3만 원 내외 · 음료비 별도 1~2만','커버차지 발생 · 총 예산 3~5만 원 정도'][idx % 8]
    : catEn === 'lounge'
    ? ['음료 1.5~2.5만 원/잔 · 테이블 최소 주문 확인','드링크 1잔 1.5~2.5만 · 테이블석 최소 주문 있음','음료 한 잔 1만5천~2만5천 · 테이블 최소 오더 확인','칵테일 기준 2만 원 내외 · 테이블 이용 시 최소 주문','음료 가격 1.5~2.5만 원대 · 좌석별 최소 오더 적용','드링크 2만 원 내외 · 테이블 최소 주문 금액 있음','음료 1잔 기준 약 2만 원 · 좌석 최소 주문 확인','칵테일 1.5~2.5만 · 테이블석은 최소 오더 필요'][idx % 8]
    : ['입장료 0~2만 원 + 음료 0.5~1.5만 원/잔','커버 무료~2만 원 · 음료 5천~1.5만/잔','입장 비용 0~2만 · 음료 한 잔 5천~1만5천','도어차지 없거나 소액 · 음료 5천~1.5만 원','입장비 없거나 1~2만 · 드링크 5천~1.5만','출입 무료 또는 소액 · 음료 5천~만5천 원대','입장 0~2만 원 내외 · 음료비 1만 원 안팎','비용 부담 적음 · 음료 포함 1인 2~4만 원 선'][idx % 8] },
];

/* JSON-LD */
const jsonLd = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebPage",
      "name": title,
      "url": pageUrl,
      "description": description,
      "primaryImageOfPage": { "@type": "ImageObject", "url": thumbAbsolute },
    },
    {
      "@type": "LocalBusiness",
      "name": venue.name,
      "url": pageUrl,
      "image": thumbAbsolute,
      "address": {
        "@type": "PostalAddress",
        "streetAddress": venue.address || '',
        "addressLocality": venue.district || '',
        "addressRegion": regionLabel,
        "addressCountry": "KR",
      },
      hasMap: mapUrl,
      ...(venue.phone ? { telephone: venue.phone } : {}),
      ...(venue.hours ? { openingHours: venue.hours } : {}),
    },
    {
      "@type": "BreadcrumbList",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "name": "홈", "item": siteUrl + "/" },
        { "@type": "ListItem", "position": 2, "name": catFullLabel, "item": `${siteUrl}/${venue.cat_slug}/` },
        { "@type": "ListItem", "position": 3, "name": regionLabel, "item": `${siteUrl}/${venue.cat_slug}/${venue.region_slug}/` },
        { "@type": "ListItem", "position": 4, "name": venue.name, "item": pageUrl },
      ],
    },
    {
      "@type": "FAQPage",
      "mainEntity": content.faqItems.map((item) => ({
        "@type": "Question",
        "name": item.q,
        "acceptedAnswer": { "@type": "Answer", "text": item.a },
      })),
    },
  ],
};

/* ── Per-venue heading variants to maximize content uniqueness ── */
const headingPool = {
  summary: ['핵심 요약', '주요 사항 정리', '한눈에 보는 포인트', '꼭 알아야 할 포인트', '필수 확인 사항', '요약 카드', '빠른 확인 사항', '한눈에 보기'],
  valueBox: ['이 페이지에서 얻는 것', '여기서 확인할 수 있는 것', '핵심 체크포인트', '페이지 활용 팁', '방문 전 참고 사항', '사전 확인 포인트', '알아두면 유용한 것', '필수 체크 모음'],
  guide: ['실전 준비 가이드', '방문 전 준비 사항', '현장 이용 안내', '사전 준비 항목', '이용 안내 정리', '현장 정보 요약', '방문 준비 요약', '이용 참고 사항'],
  quickPlan: ['30초 결정표', '빠른 선택 도우미', '의사결정 요약표', '선택지 비교표', '판단 도우미', '비교 선택표', '빠른 비교 가이드', '선택 요약'],
  scenarios: ['3가지 방문 시나리오', '추천 방문 플랜', '상황별 이용 계획', '방문 계획 예시', '시나리오별 플랜', '방문 유형별 안내', '이용 시나리오', '타입별 방문 계획'],
  related: ['함께 살펴볼 만한 곳', '비슷한 분위기의 장소', '관련 추천 목록', '같이 둘러볼 장소', '추천 연계 방문지', '비교해 볼 장소', '유사 분위기 장소', '근처 다른 선택지'],
  navSummary: ['요약', '핵심', '개요', '한눈에', '정리', '포인트', '기본', '미리보기'],
  navIntro: ['소개', '안내', '시작', '입문', '첫걸음', '가이드', '개관', '오리엔테이션'],
  navPrologue: ['프롤로그', '여는 글', '시작점', '배경', '도입부', '현장 소개', '출발', '첫 장면'],
  navScene1: ['선택의 순간', '핵심 장면', '메인 스토리', '본편', '현장 1', '주요 장면', '스냅샷', '하이라이트'],
  navScene2: ['첫인상', '디테일', '후반부', '세부 장면', '현장 2', '마무리 장면', '속편', '심층 장면'],
};
function pickH(pool) { return pool[idx % pool.length]; }
const hSummary = pickH(headingPool.summary);
const hValueBox = pickH(headingPool.valueBox);
const hGuide = pickH(headingPool.guide);
const hQuickPlan = pickH(headingPool.quickPlan);
const hScenarios = pickH(headingPool.scenarios);
const hRelated = pickH(headingPool.related);

/* Section IDs for navigation */
const sections = [
  { id: 'ai-summary', label: pickH(headingPool.navSummary) },
  { id: 'intro', label: pickH(headingPool.navIntro) },
  { id: 'prologue', label: pickH(headingPool.navPrologue) },
  { id: 'scene1', label: pickH(headingPool.navScene1) },
  { id: 'scene2', label: pickH(headingPool.navScene2) },
  { id: 'quick-plan', label: '퀵플랜' },
  { id: 'checklist', label: '체크리스트' },
  { id: 'faq-section', label: 'Q&A' },
  { id: 'bottom-cta', label: '마무리' },
];
---

<BaseLayout title={title} description={description} ogImage={thumbPath} jsonLd={jsonLd}>
  <Fragment slot="head">
    <meta name="keywords" content={allKeywords} />
    <meta property="article:section" content={`${regionLabel} ${catFullLabel}`} />
    <meta property="article:published_time" content={publishedTime} />
    <meta property="article:modified_time" content={modifiedTime} />
    <meta property="article:tag" content={venue.name} />
    <meta property="article:tag" content={`${regionLabel} ${catFullLabel}`} />
    <meta property="og:image:alt" content={thumbAlt} />
    {hasWebpThumb && <link rel="preload" as="image" type="image/webp" href={thumbWebp} />}
    {!hasWebpThumb && <link rel="preload" as="image" href={thumbPath} />}
  </Fragment>
  <main id="main-content" class="detail-page">

    {/* ── Reading Progress Bar ── */}
    <div class="reading-progress" id="reading-progress" aria-hidden="true">
      <div class="reading-progress__bar" id="reading-progress-bar"></div>
    </div>

    {/* ── [0] Detail Hero ── */}
    <section class="detail-hero" data-reveal>
      {/* 1) Thumbnail at top */}
      <figure class="detail-hero__figure">
        <picture>
          {hasWebpThumb && <source srcset={thumbWebp} type="image/webp" />}
          <img
            src={thumbPath}
            alt={thumbAlt}
            width="520"
            height="520"
            loading="eager"
            decoding="async"
            fetchpriority="high"
          />
        </picture>
      </figure>

      {/* 2) H1 = Store Name */}
      <h1 class="detail-hero__title">{venue.name}</h1>

      {/* 3) Quick meta row */}
      <div class="detail-hero__meta">
        <span class="detail-hero__meta-item">{catFullLabel}</span>
        <span class="detail-hero__meta-sep">·</span>
        <span class="detail-hero__meta-item">{regionLabel} {venue.district}</span>
        <span class="detail-hero__meta-sep">·</span>
        <span class="detail-hero__meta-item detail-hero__meta-date">업데이트 {lastUpdated}</span>
      </div>

      {/* 4) CTA row */}
      <div class="detail-hero__ctas">
        <a href={mapUrl} class="btn btn--primary" target="_blank" rel="noopener noreferrer">{['지도에서 보기','위치 확인','지도 열기','길찾기','약도 보기','지도 확인','경로 보기','위치 보기'][idx % 8]}</a>
        <a href="/" class="btn btn--outline" target="_blank" rel="noopener noreferrer">{['다른 장소 둘러보기','목록으로','전체 리스트','다른 곳 보기','더 많은 장소','리스트로','전체 보기','홈으로'][idx % 8]}</a>
      </div>
    </section>

    {/* ── [0.5] Value Hook Intro ── */}
    <section class="detail-hero-intro" data-reveal>
      <p class="detail-hero-intro__tagline">{heroTag}</p>
      <div class="quick-summary">
        <h2 class="quick-summary__title">{pickH(headingPool.summary)}</h2>
        <ul>
          <li><strong>{['카테고리','분류','타입','종류','구분','유형','형태','장르'][idx % 8]}:</strong> {catFullLabel}</li>
          <li><strong>{['지역','소재지','위치','장소','동네','에어리어','구역','소재'][idx % 8]}:</strong> {venue.address}</li>
          <li><strong>{['교통','접근성','이동편','가는 길','교통편','오시는 길','루트','경로'][idx % 8]}:</strong> {venue.station || '확인 필요'}</li>
          <li><strong>{['운영 참고','시간 안내','이용 시간','영업 정보','시간대','스케줄','운영 안내','시간 참고'][idx % 8]}:</strong> {venue.hours || '확인 필요'}</li>
          {venue.phone && <li><strong>연락처:</strong> {venue.phone}</li>}
        </ul>
      </div>
    </section>

    {/* ── Reading Time + Section Nav ── */}
    <div class="reading-meta" data-reveal>
      <span class="reading-meta__time">{['약','대략','예상','소요','읽기','분량','대충','평균'][idx % 8]} {content.readingTimeMin}분</span>
      <nav class="reading-meta__nav" aria-label="섹션 이동">
        {sections.map(s => (
          <a href={`#${s.id}`} class="reading-meta__link" target="_blank" rel="noopener noreferrer">{s.label}</a>
        ))}
      </nav>
    </div>

    {/* ── [AI] Summary Block ── */}
    <section class="ai-summary" id="ai-summary" data-reveal>
      <h2 class="ai-summary__title">{hSummary}</h2>
      <ul class="ai-summary__list">
        {content.aiSummary.map(bullet => (
          <li>{bullet}</li>
        ))}
      </ul>
    </section>

    {/* ── [A] VALUE HOOK INTRO ── */}
    <section class="value-intro" id="intro" data-reveal>
      <p class="value-intro__hook">{content.introHook}</p>

      <div class="value-intro__value-box">
        <h2 class="value-intro__value-title">{hValueBox}</h2>
        <ul class="value-intro__bullets">
          {content.introBullets.map(b => <li>{b}</li>)}
        </ul>
      </div>

      <div class="value-intro__teaser">
        <p>{content.introTeaser}</p>
      </div>
    </section>

    {/* ── [B-1] 3분 프롤로그 ── */}
    <section class="story-section" id="prologue" data-reveal>
      <h2 class="story-section__heading">{content.prologueTitle}</h2>
      <div class="story-section__body">
        <Fragment set:html={content.prologue} />
      </div>
    </section>

    {/* ── [B-2] 장면 1: 선택의 순간 ── */}
    <section class="story-section" id="scene1" data-reveal>
      <h2 class="story-section__heading">{content.scene1Title}</h2>
      <div class="story-section__body">
        <Fragment set:html={content.scene1} />
      </div>
    </section>

    {/* ── [B-3] 장면 2: 첫인상 디테일 ── */}
    <section class="story-section" id="scene2" data-reveal>
      <h2 class="story-section__heading">{content.scene2Title}</h2>
      <div class="story-section__body">
        <Fragment set:html={content.scene2} />
      </div>
    </section>

    {/* ── Extra: Tip Section ── */}
    <section class="story-section" data-reveal>
      <div class="story-section__body story-section__extra">
        <Fragment set:html={content.tipSection} />
      </div>
    </section>

    {/* ── Extra: Dialogue / Twist Section ── */}
    <section class="story-section" data-reveal>
      <div class="story-section__body story-section__extra">
        <Fragment set:html={content.dialogueSection} />
      </div>
    </section>

    {/* ── [2] Practical Guide ── */}
    <section class="detail-section" data-reveal>
      <h2 class="detail-section__heading">{hGuide}</h2>
      <div class="detail-table-wrap">
        <table class="detail-table">
          <tbody>
            {guideRows.map(row => (
              <tr>
                <th>{row.label}</th>
                <td>{row.value}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </section>

    {/* ── [B-5] 처음 가는 사람 체크리스트 ── */}
    <section class="detail-section" id="checklist" data-reveal>
      <h2 class="detail-section__heading">{content.checklistTitle}</h2>
      <ul class="checklist-list">
        {content.checklist.map(item => (
          <li class="checklist-list__item">
            <span class="checklist-list__icon" aria-hidden="true">&#10003;</span>
            <span>{item}</span>
          </li>
        ))}
      </ul>
    </section>

    {/* ── [QP] Quick Plan ── */}
    <section class="detail-section quick-plan" id="quick-plan" data-reveal>
      <h2 class="detail-section__heading">{hQuickPlan}</h2>
      <div class="quick-plan__table-wrap">
        <table class="detail-table">
          <thead>
            <tr>
              <th>{['항목','기준','조건','비교점','선택지','카테고리','구분','분류'][idx % 8]}</th>
              <th>{['옵션 A','선택 1','첫 번째','방법 A','안 1','루트 A','플랜 A','경우 1'][idx % 8]}</th>
              <th>{['옵션 B','선택 2','두 번째','방법 B','안 2','루트 B','플랜 B','경우 2'][idx % 8]}</th>
            </tr>
          </thead>
          <tbody>
            {content.quickPlan.decisionTable.map(row => (
              <tr>
                <th>{row.label}</th>
                <td>{row.optionA}</td>
                <td>{row.optionB}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      <h3 class="quick-plan__sub">{hScenarios}</h3>
      <div class="quick-plan__scenarios">
        {content.quickPlan.scenarios.map(s => (
          <div class="quick-plan__scenario">
            <strong>{s.title}</strong>
            <p>{s.desc}</p>
          </div>
        ))}
      </div>

      <p class="quick-plan__cost-note">{content.quickPlan.costNote}</p>
    </section>

    {/* ── [B-6] 실전 Q&A ── */}
    <FAQ items={content.faqItems} title={['자주 묻는 질문', '궁금한 점 정리', '방문 전 Q&A', '실전 질문과 답변', '자주 나오는 질문', '문의 모음', '핵심 Q&A', '이용 관련 질문'][idx % 8]} />

    {/* ── [5] Trust Block ── */}
    <TrustBlock storeName={venue.name} variant={idx} />

    {/* ── [B-7] 마무리(결론) ── */}
    <section class="story-section detail-bottom-cta" id="bottom-cta" data-reveal>
      <h2 class="story-section__heading">{content.outroTitle}</h2>
      <div class="story-section__body">
        <Fragment set:html={content.outro} />
      </div>
      <div class="story-section__ctas">
        <a href={mapUrl} class="btn btn--primary" target="_blank" rel="noopener noreferrer">{['지도에서 위치 확인','약도 확인하기','경로 살펴보기','지도로 이동','위치 알아보기','길 확인하기','현장 위치 보기','지도 바로가기'][idx % 8]}</a>
        <a href="/" class="btn btn--outline" target="_blank" rel="noopener noreferrer">{['다른 장소 살펴보기','전체 리스트 보기','목록 돌아가기','더 둘러보기','다른 곳 탐색','리스트 확인','홈으로 돌아가기','전체 목록'][idx % 8]}</a>
      </div>
    </section>

    {/* ── [7] Related Venues ── */}
    {relatedVenues.length > 0 && (
      <section class="detail-section" data-reveal>
        <h2 class="detail-section__heading">{hRelated}</h2>
        <div class="detail-related">
          {relatedVenues.map((v: any) => (
            <a
              href={venueDetailPath(v)}
              class="detail-related__link"
              target="_blank"
              rel="noopener noreferrer"
            >
              <strong>{v.name}</strong>
              <span>{v.district}</span>
            </a>
          ))}
        </div>
      </section>
    )}

  </main>
</BaseLayout>

<style is:global>
/* ═══ Detail Page — Dynamic Template Styles ═══ */
/* Using is:global so styles apply to set:html content (no data-astro-cid) */

/* ── Reading Progress Bar ── */
.reading-progress {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 3px;
  background: transparent;
  z-index: 9999;
  pointer-events: none;
}
.reading-progress__bar {
  height: 100%;
  width: 0%;
  background: var(--c-accent, #c8a86e);
  transition: width 80ms linear;
}

/* ── Reading Meta (time + nav) ── */
.detail-page .reading-meta {
  margin: 0 auto var(--sp-lg);
  padding: var(--sp-md) 0;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  gap: var(--sp-sm) var(--sp-lg);
}
.detail-page .reading-meta__time {
  font-size: var(--t-small);
  color: var(--c-muted);
  background: var(--c-bg-section);
  padding: 4px 12px;
  border-radius: 999px;
  white-space: nowrap;
}
.detail-page .reading-meta__nav {
  display: flex;
  flex-wrap: wrap;
  gap: var(--sp-xs);
}
.detail-page .reading-meta__link {
  font-size: var(--t-caption);
  color: var(--c-text-soft);
  text-decoration: none;
  padding: 4px 10px;
  border: 1px solid var(--c-border);
  border-radius: 999px;
  transition: all .15s;
}
.detail-page .reading-meta__link:hover {
  background: var(--c-accent-soft);
  border-color: var(--c-accent);
  color: var(--c-accent-text);
  text-decoration: none;
}

/* ── Value Hook Intro ── */
.detail-page .value-intro {
  margin: 0 auto var(--section-gap);
  padding: 0;
  text-align: center;
}
.detail-page .value-intro__hook {
  font-family: var(--font-display);
  font-size: var(--t-h3);
  line-height: var(--lh-body);
  color: var(--c-text);
  margin-bottom: var(--sp-lg);
  padding: var(--sp-md) var(--sp-lg);
  background: var(--c-bg-warm);
  border-radius: var(--r-md);
  border-top: 3px solid var(--c-accent);
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}
.detail-page .value-intro__value-box {
  background: var(--c-bg-section);
  border-radius: var(--r-md);
  padding: var(--sp-lg);
  margin-bottom: var(--sp-lg);
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
  text-align: left;
}
.detail-page .value-intro__value-title {
  font-size: var(--t-body);
  font-weight: 700;
  margin-bottom: var(--sp-sm);
  color: var(--c-text);
  text-align: center;
}
.detail-page .value-intro__bullets {
  list-style: none;
  padding: 0;
  margin: 0;
}
.detail-page .value-intro__bullets li {
  position: relative;
  padding-left: 20px;
  margin-bottom: var(--sp-xs);
  font-size: var(--t-body);
  line-height: var(--lh-body);
  color: var(--c-text-soft);
}
.detail-page .value-intro__bullets li::before {
  content: '→';
  position: absolute;
  left: 0;
  color: var(--c-accent);
  font-weight: 700;
}
.detail-page .value-intro__teaser {
  background: var(--c-bg-warm);
  border-radius: var(--r-md);
  padding: var(--sp-lg);
  font-style: italic;
  color: var(--c-text-soft);
  line-height: var(--lh-body);
  border-top: 2px solid var(--c-accent-soft, rgba(200,168,110,.3));
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}

/* ── Story Sections (set:html content) ── */
.detail-page .story-section {
  margin: 0 auto var(--section-gap);
  padding: 0;
}
.detail-page .story-section__heading {
  font-family: var(--font-display);
  font-size: var(--t-h2);
  line-height: var(--lh-heading);
  color: var(--c-navy);
  margin-bottom: var(--sp-lg);
  padding-bottom: var(--sp-sm);
  border-bottom: 2px solid var(--c-accent-soft, rgba(200,168,110,.2));
  text-align: center;
}
.detail-page .story-section__body {
  font-size: var(--t-body);
  line-height: var(--lh-body);
  color: var(--c-text-soft);
  max-width: 68ch;
  margin-left: auto;
  margin-right: auto;
}
.detail-page .story-section__body p {
  margin-bottom: var(--sp-md);
}
.detail-page .story-section__body h3 {
  font-family: var(--font-display);
  font-size: var(--t-h3);
  color: var(--c-navy);
  margin-top: var(--sp-xl);
  margin-bottom: var(--sp-md);
  text-align: center;
}
.detail-page .story-section__body .dialogue {
  background: var(--c-bg-section);
  padding: var(--sp-md) var(--sp-lg);
  border-radius: var(--r-md);
  font-style: italic;
  margin: var(--sp-lg) auto;
  border-top: 3px solid var(--c-accent);
  text-align: center;
  max-width: 400px;
}
.detail-page .story-section__ctas {
  display: flex;
  flex-wrap: wrap;
  gap: var(--sp-sm);
  margin-top: var(--sp-xl);
  justify-content: center;
}

/* ── Checklist ── */
.detail-page .checklist-list {
  list-style: none;
  padding: 0;
  margin: 0 auto;
  max-width: var(--max-narrow, 720px);
}
.detail-page .checklist-list__item {
  display: flex;
  align-items: flex-start;
  gap: var(--sp-sm);
  padding: var(--sp-sm) 0;
  border-bottom: 1px solid var(--c-border-light);
  font-size: var(--t-body);
  line-height: var(--lh-body);
  color: var(--c-text-soft);
}
.detail-page .checklist-list__icon {
  flex-shrink: 0;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--c-accent-soft);
  color: var(--c-accent-text);
  border-radius: 50%;
  font-size: 12px;
  font-weight: 700;
  margin-top: 3px;
}

/* ── AI Summary Block ── */
.detail-page .ai-summary {
  margin: 0 auto var(--section-gap);
  padding: var(--sp-lg);
  background: var(--c-bg-section);
  border-radius: var(--r-md, 12px);
  border-top: 4px solid var(--c-accent);
  max-width: 600px;
}
.detail-page .ai-summary__title {
  font-family: var(--font-display);
  font-size: var(--t-h3);
  color: var(--c-navy);
  margin-bottom: var(--sp-md);
  line-height: var(--lh-heading);
  text-align: center;
}
.detail-page .ai-summary__list {
  list-style: none;
  padding: 0;
  margin: 0;
  text-align: left;
}
.detail-page .ai-summary__list li {
  position: relative;
  padding-left: 22px;
  margin-bottom: var(--sp-xs);
  font-size: var(--t-body);
  line-height: var(--lh-body);
  color: var(--c-text-soft);
}
.detail-page .ai-summary__list li::before {
  content: '•';
  position: absolute;
  left: 6px;
  color: var(--c-accent);
  font-weight: 700;
  font-size: 1.1em;
}

/* ── Quick Plan ── */
.detail-page .quick-plan__table-wrap {
  overflow-x: auto;
  margin-bottom: var(--sp-lg);
}
.detail-page .quick-plan__sub {
  font-family: var(--font-display);
  font-size: var(--t-h3);
  color: var(--c-navy);
  margin-bottom: var(--sp-md);
  text-align: center;
}
.detail-page .quick-plan__scenarios {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--sp-sm);
  margin-bottom: var(--sp-lg);
}
.detail-page .quick-plan__scenario {
  background: var(--c-bg-section);
  border: 1px solid var(--c-border-light);
  border-radius: var(--r-md, 12px);
  padding: var(--sp-md);
}
.detail-page .quick-plan__scenario strong {
  display: block;
  color: var(--c-navy);
  margin-bottom: var(--sp-xs);
  font-size: var(--t-body);
}
.detail-page .quick-plan__scenario p {
  margin: 0;
  font-size: var(--t-small);
  line-height: var(--lh-body);
  color: var(--c-text-soft);
}
.detail-page .quick-plan__cost-note {
  font-size: var(--t-small);
  color: var(--c-muted);
  font-style: italic;
  line-height: var(--lh-body);
  padding: var(--sp-sm) var(--sp-md);
  background: var(--c-bg-warm);
  border-radius: var(--r-sm, 8px);
  text-align: center;
}

/* ── Detail Hero — Enhanced ── */
.detail-page .detail-hero {
  text-align: center;
  padding: var(--sp-xl) 0 var(--sp-lg);
}
.detail-page .detail-hero__figure {
  display: flex;
  justify-content: center;
  margin: 0 auto var(--sp-lg);
  max-width: 480px;
}
.detail-page .detail-hero__figure img {
  width: 100%;
  max-width: 480px;
  aspect-ratio: 1 / 1;
  object-fit: cover;
  border-radius: 18px;
  box-shadow: 0 8px 32px rgba(15, 23, 42, 0.10);
}
.detail-page .detail-hero__title {
  font-family: var(--font-display);
  font-size: var(--t-h1);
  font-weight: 700;
  line-height: 1.3;
  color: var(--c-navy);
  margin-bottom: var(--sp-sm);
}
.detail-page .detail-hero__meta {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
  gap: 4px 6px;
  font-size: var(--t-small);
  color: var(--c-muted);
  margin-bottom: var(--sp-lg);
}
.detail-page .detail-hero__ctas {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: var(--sp-sm);
}

/* ── Detail Hero Intro ── */
.detail-page .detail-hero-intro {
  padding: 0 0 var(--sp-lg);
}
.detail-page .detail-hero-intro__tagline {
  font-family: var(--font-display);
  font-size: var(--t-h3);
  font-style: italic;
  color: var(--c-text-soft);
  line-height: var(--lh-body);
  margin-bottom: var(--sp-lg);
  text-align: center;
}

/* ── Mobile responsive ── */
@media (max-width: 599px) {
  .detail-page .detail-hero__figure { max-width: 100%; }
  .detail-page .detail-hero__figure img { border-radius: 14px; }
  .detail-page .detail-hero__ctas { flex-direction: column; }
  .detail-page .detail-hero__ctas .btn { width: 100%; text-align: center; }
}
</style>

<script>
  // Reading progress bar
  const bar = document.getElementById('reading-progress-bar');
  if (bar) {
    const update = () => {
      const scrollTop = window.scrollY;
      const docHeight = document.documentElement.scrollHeight - window.innerHeight;
      if (docHeight > 0) {
        const pct = Math.min(100, (scrollTop / docHeight) * 100);
        bar.style.width = pct + '%';
      }
    };
    window.addEventListener('scroll', update, { passive: true });
    update();
  }
</script>
