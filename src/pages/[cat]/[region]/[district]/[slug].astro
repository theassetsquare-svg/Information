---
import BaseLayout from '../../../../layouts/BaseLayout.astro';
import FAQ from '../../../../components/FAQ.astro';
import TrustBlock from '../../../../components/TrustBlock.astro';
import venuesData from '../../../../data/venues.json';
import { generateAllContent, hookTitles, hookDescs } from '../../../../lib/venue-content';
import type { Venue } from '../../../../lib/venue-content-types';
import { dedupeVenuePathParams, venueDetailPath } from '../../../../lib/slug-utils';

/* ───────── getStaticPaths ───────── */
export function getStaticPaths() {
  return venuesData
    .filter((v: any) => !v.detail_page)
    .map((v: any) => {
      const dd = dedupeVenuePathParams(v.cat_slug, v.region_slug, v.district_slug, v.slug);
      return {
        params: {
          cat: v.cat_slug,
          region: v.region_slug,
          district: dd.district,
          slug: dd.slug,
        },
        props: { venue: v },
      };
    });
}

/* ───────── props & content gen ───────── */
const { venue } = Astro.props as { venue: Venue };
const idx = venuesData.findIndex((v: any) => v.slug === venue.slug);
const content = generateAllContent(venue, idx);

/* ───────── helpers ───────── */
const catLabel = venue.category;
const catEn = venue.cat_slug;
const regionLabel = venue.region;
const siteUrl = 'https://informationa.pages.dev';
const pageUrl = `${siteUrl}${venueDetailPath(venue)}`;
const catFullLabel = catLabel === '클럽' ? '클럽' : catLabel === '나이트' ? '나이트' : '라운지';

/* Thumbnail */
const thumbPath = venue.thumbnail || '/images/og-thumb.jpg';
const thumbAbsolute = thumbPath.startsWith('http') ? thumbPath : `${siteUrl}${thumbPath}`;
const thumbAlt = `${venue.name} ${regionLabel} ${venue.district} ${catFullLabel} — 내부 분위기와 인테리어`;
const thumbWebp = thumbPath.replace(/\.(png|jpe?g)$/i, '.webp');
const hasWebpThumb = thumbWebp !== thumbPath;

/* Map URL: use venue.map_url if available, else Google Maps search fallback */
const mapUrl = venue.map_url || `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(venue.name + ' ' + regionLabel)}`;

/* Last updated date */
const lastUpdated = '2026.02.21';

/* Hero tagline — per-venue unique from JSON */
const heroTag = content.heroTagline || '밤의 에너지를 온몸으로 느끼다';

/* Related venues */
const relatedVenues = venuesData
  .filter((v: any) => v.slug !== venue.slug && (v.category === venue.category || v.region === venue.region))
  .slice(0, 4);

/* SEO */
const hookTitle = hookTitles[venue.slug] || '';
const title = hookTitle
  ? `${venue.name} — ${hookTitle}`
  : `${venue.name} | ${regionLabel} ${venue.district} ${catFullLabel} 완전 가이드`;
const stationShort = venue.station ? venue.station.split(',')[0].trim() : '';
const hookDesc = hookDescs[venue.slug] || '';
const description = hookDesc || (() => {
  const tagStr = venue.tags?.length ? venue.tags.slice(0, 3).join('·') : '';
  const hooks = [
    `${venue.name} — 가기 전에 타이밍부터 확인하자. ${regionLabel} ${venue.district} ${catFullLabel}${tagStr ? ' · ' + tagStr : ''} — 이성 비율·분위기·피크타임 정리.`,
    `${venue.name} — 자리 선택부터 다르게 가야 한다. ${regionLabel} ${venue.district} ${catFullLabel}${tagStr ? ' · ' + tagStr : ''} — 현장 경험 토대로 정리.`,
    `${venue.name} — 혼자 가도 어울릴 수 있는 곳인가? 솔직하게 답한다. ${regionLabel} ${venue.district} ${catFullLabel}${tagStr ? ' · ' + tagStr : ''} — 분위기·남녀 비율 가이드.`,
    `${venue.name} — 시간대를 모르면 헛걸음이다. ${regionLabel} ${venue.district} ${catFullLabel}${tagStr ? ' · ' + tagStr : ''} — 시간대별 분위기·이성 비율 분석.`,
    `${venue.name} — 마음에 드는 사람을 만날 확률이 높은 곳. ${regionLabel} ${venue.district} ${catFullLabel}${tagStr ? ' · ' + tagStr : ''} — 좌석 배치·분위기·피크타임.`,
    `${venue.name} — 장소 선택이 오늘 밤 결과를 바꾼다. ${regionLabel} ${venue.district} ${catFullLabel}${tagStr ? ' · ' + tagStr : ''} — 좌석·타이밍·분위기 정리.`,
    `${venue.name} — 이성 비율 확인 없이 가면 후회한다. ${regionLabel} ${venue.district} ${catFullLabel}${tagStr ? ' · ' + tagStr : ''} — 피크타임·분위기·현장 가이드.`,
    `${venue.name} — 이 한 페이지면 현장 파악 끝. ${regionLabel} ${venue.district} ${catFullLabel}${tagStr ? ' · ' + tagStr : ''} — 좌석·분위기·타이밍 정리.`,
  ];
  const descRaw = hooks[idx % hooks.length];
  return descRaw.length > 155 ? descRaw.slice(0, 152) + '...' : descRaw;
})();

/* Keywords meta */
const baseKeywords = venue.keywords || [];
const extraKeywords = [
  venue.name,
  `${regionLabel} ${catFullLabel}`,
  `${venue.district} ${catFullLabel}`,
  `${venue.name} 위치`,
  `${venue.name} 영업시간`,
  `${venue.name} 입장료`,
  `${venue.name} 후기`,
  `${regionLabel} ${venue.district} ${catFullLabel} 추천`,
  stationShort ? `${stationShort} ${catFullLabel}` : '',
].filter(Boolean);
const allKeywords = [...new Set([...baseKeywords, ...extraKeywords])].join(',');

/* Article meta for Naver freshness signals */
const publishedTime = '2025-12-01T00:00:00+09:00';
const modifiedTime = new Date().toISOString();

/* Practical guide rows — venue data only (no category pools = zero shared text) */
const _gl = [
  ['운영시간', '영업 시간대', '오픈·마감', '이용 가능 시간', '문 여는 시간', '운영 스케줄', '시간 참고', '오픈 일정', '영업 안내', '운영 일정', '시간대 안내', '개방 시간', '이용 시간대', '오픈 시간', '영업 참고', '시간 정보', '일정 참고', '운영 정보', '오픈 참고', '시간대 참고', '영업 일정'],
  ['위치 / 교통', '주소 · 교통편', '찾아오는 길', '접근 경로', '소재지 참고', '이동 방법', '교통 요약', '오시는 길', '주소 안내', '위치 안내', '경로 안내', '교통 정보', '소재지 안내', '방향 안내', '접근 방법', '이동 안내', '길 안내', '교통 참고', '경로 참고', '위치 참고', '소재 안내'],
  ['예약 / 입장', '사전 준비', '입장 절차', '출입 절차', '예약 방법', '입장 방식', '방문 절차', '출입 참고', '입장 안내', '예약 참고', '출입 방법', '접수 안내', '입장 방법', '방문 안내', '출입 안내', '예약 안내', '절차 참고', '등록 안내', '입장 참고', '접수 참고', '사전 안내'],
  ['복장 / 분위기', '착장 참고', '옷차림 가이드', '분위기 힌트', '스타일 참고', '복장 팁', '착장 팁', '분위기 참고', '복장 안내', '착장 안내', '스타일 안내', '옷차림 참고', '드레스 참고', '복장 정보', '착장 정보', '분위기 안내', '의상 참고', '복장 참고', '스타일 정보', '착장 가이드', '드레스 안내'],
  ['예산 감각', '비용 참고', '지출 범위', '예상 경비', '가격 수준', '예산 참고', '비용 요약', '지출 가이드', '비용 안내', '예산 안내', '금액 참고', '지출 안내', '비용 정보', '예산 정보', '금액 안내', '경비 안내', '가격 안내', '예산 범위', '비용 범위', '지출 참고', '금액 정보'],
];
const guideRows = [
  { label: _gl[0][idx % 21], value: venue.hours || '확인 필요' },
  { label: _gl[1][(idx * 3 + 1) % 21], value: `${venue.address} · ${venue.station}` },
  { label: _gl[2][(idx * 5 + 2) % 21], value: venue.phone ? `${venue.phone} 사전 확인` : '현장 확인' },
  { label: _gl[3][(idx * 7 + 3) % 21], value: (venue.tags?.slice(0, 3).join(', ') || catFullLabel) },
  { label: _gl[4][(idx * 11 + 4) % 21], value: '현장 확인' },
];

/* JSON-LD */
const jsonLd = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebPage",
      "name": title,
      "url": pageUrl,
      "description": description,
      "primaryImageOfPage": { "@type": "ImageObject", "url": thumbAbsolute },
    },
    {
      "@type": "LocalBusiness",
      "name": venue.name,
      "url": pageUrl,
      "image": thumbAbsolute,
      "address": {
        "@type": "PostalAddress",
        "streetAddress": venue.address || '',
        "addressLocality": venue.district || '',
        "addressRegion": regionLabel,
        "addressCountry": "KR",
      },
      hasMap: mapUrl,
      ...(venue.phone ? { telephone: venue.phone } : {}),
      ...(venue.hours ? { openingHours: venue.hours } : {}),
    },
    {
      "@type": "BreadcrumbList",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "name": "홈", "item": siteUrl + "/" },
        { "@type": "ListItem", "position": 2, "name": catFullLabel, "item": `${siteUrl}/${venue.cat_slug}/` },
        { "@type": "ListItem", "position": 3, "name": regionLabel, "item": `${siteUrl}/${venue.cat_slug}/${venue.region_slug}/` },
        { "@type": "ListItem", "position": 4, "name": venue.name, "item": pageUrl },
      ],
    },
    {
      "@type": "FAQPage",
      "mainEntity": content.faqItems.map((item) => ({
        "@type": "Question",
        "name": item.q,
        "acceptedAnswer": { "@type": "Answer", "text": item.a },
      })),
    },
  ],
};

/* ── Per-venue unique headings — venue name guarantees zero text overlap ── */
const _hw = {
  s: ['핵심','요점','팩트','필수','개요','기본','주요','종합','정수','골자','한줄','압축','응축','간추린','추린','모은','뽑은','추출','선별','엄선','집약'],
  v: ['체크','확인','점검','파악','준비','기본','참고','필수','사전','핵심','중요','정리','활용','포인트','살펴볼','알아볼','챙길','잡을','미리볼','선행','예비'],
  g: ['실전','현장','방문','이용','준비','탐방','출입','사전','활용','참고','실용','기초','안내','정보','직접','이용자','탐색','입문','초행','개괄','전반'],
  q: ['결정표','선택표','비교표','판단표','계획표','플래너','옵션표','가이드표','코스표','일정표','견적표','스케줄표','루트표','대조표','진단표','세부표','분석표','종합표','도식표','배분표','대비표'],
  sc: ['플랜','계획','코스','일정','루트','시나리오','동선','여정','패턴','유형','스타일','구성','순서','방식','모델','케이스','프로그램','설계','배치','흐름','조합'],
};
const hSummary = `${venue.name} ${_hw.s[idx % _hw.s.length]} 정리`;
const hValueBox = `${venue.name} ${_hw.v[idx % _hw.v.length]} 포인트`;
const hGuide = `${venue.name} ${_hw.g[idx % _hw.g.length]} 가이드`;
const hQuickPlan = `${venue.name} ${_hw.q[idx % _hw.q.length]}`;
const hScenarios = `${venue.name} 추천 ${_hw.sc[idx % _hw.sc.length]}`;
const hRelated = `${venue.name} 근처 추천`;

/* Section IDs — derive from venue-specific content titles for uniqueness */
const _navShort = (s: string) => s.replace(/<[^>]*>/g,'').slice(0, 4).trim() || '보기';
const sections = [
  { id: 'ai-summary', label: `${venue.name.slice(0,2)}정리` },
  { id: 'intro', label: `${venue.name.slice(0,2)}소개` },
  { id: 'prologue', label: _navShort(content.prologueTitle) },
  { id: 'scene1', label: _navShort(content.scene1Title) },
  { id: 'scene2', label: _navShort(content.scene2Title) },
  { id: 'quick-plan', label: '퀵플랜' },
  { id: 'checklist', label: '체크리스트' },
  { id: 'faq-section', label: 'Q&A' },
  { id: 'bottom-cta', label: '마무리' },
];
---

<BaseLayout title={title} description={description} ogImage={thumbPath} jsonLd={jsonLd}>
  <Fragment slot="head">
    <meta name="keywords" content={allKeywords} />
    <meta property="article:section" content={`${regionLabel} ${catFullLabel}`} />
    <meta property="article:published_time" content={publishedTime} />
    <meta property="article:modified_time" content={modifiedTime} />
    <meta property="article:tag" content={venue.name} />
    <meta property="article:tag" content={`${regionLabel} ${catFullLabel}`} />
    <meta property="og:image:alt" content={thumbAlt} />
    {hasWebpThumb && <link rel="preload" as="image" type="image/webp" href={thumbWebp} />}
    {!hasWebpThumb && <link rel="preload" as="image" href={thumbPath} />}
  </Fragment>
  <main id="main-content" class="detail-page">

    {/* ── Reading Progress Bar ── */}
    <div class="reading-progress" id="reading-progress" aria-hidden="true">
      <div class="reading-progress__bar" id="reading-progress-bar"></div>
    </div>

    {/* ── [0] Detail Hero ── */}
    <section class="detail-hero" data-reveal>
      {/* 1) Thumbnail at top */}
      <figure class="detail-hero__figure">
        <picture>
          {hasWebpThumb && <source srcset={thumbWebp} type="image/webp" />}
          <img
            src={thumbPath}
            alt={thumbAlt}
            width="520"
            height="520"
            loading="eager"
            decoding="async"
            fetchpriority="high"
          />
        </picture>
      </figure>

      {/* 2) H1 = Store Name */}
      <h1 class="detail-hero__title">{venue.name}</h1>

      {/* 3) Quick meta row */}
      <div class="detail-hero__meta">
        <span class="detail-hero__meta-item">{catFullLabel}</span>
        <span class="detail-hero__meta-sep">·</span>
        <span class="detail-hero__meta-item">{regionLabel} {venue.district}</span>
        <span class="detail-hero__meta-sep">·</span>
        <span class="detail-hero__meta-item detail-hero__meta-date">업데이트 {lastUpdated}</span>
      </div>

      {/* 4) CTA row */}
      <div class="detail-hero__ctas">
        <a href={mapUrl} class="btn btn--primary" target="_blank" rel="noopener noreferrer">{venue.name} 위치 보기</a>
        <a href="/" class="btn btn--outline" target="_blank" rel="noopener noreferrer">다른 {catFullLabel} 둘러보기</a>
      </div>
    </section>

    {/* ── [0.5] Value Hook Intro ── */}
    <section class="detail-hero-intro" data-reveal>
      <p class="detail-hero-intro__tagline">{heroTag}</p>
      <div class="quick-summary">
        <h2 class="quick-summary__title">{venue.name} 기본 정보</h2>
        <ul>
          <li><strong>{venue.name} 카테고리:</strong> {catFullLabel}</li>
          <li><strong>{venue.name} 주소:</strong> {venue.address}</li>
          <li><strong>{venue.name} 교통:</strong> {venue.station || '확인 필요'}</li>
          <li><strong>{venue.name} 운영:</strong> {venue.hours || '확인 필요'}</li>
          {venue.phone && <li><strong>{venue.name} 연락처:</strong> {venue.phone}</li>}
        </ul>
      </div>
    </section>

    {/* ── Reading Time + Section Nav ── */}
    <div class="reading-meta" data-reveal>
      <span class="reading-meta__time">{venue.name} 읽기 {content.readingTimeMin}분</span>
      <nav class="reading-meta__nav" aria-label="섹션 이동">
        {sections.map(s => (
          <a href={`#${s.id}`} class="reading-meta__link" target="_blank" rel="noopener noreferrer">{s.label}</a>
        ))}
      </nav>
    </div>

    {/* ── [AI] Summary Block ── */}
    <section class="ai-summary" id="ai-summary" data-reveal>
      <h2 class="ai-summary__title">{hSummary}</h2>
      <ul class="ai-summary__list">
        {content.aiSummary.map(bullet => (
          <li>{bullet}</li>
        ))}
      </ul>
    </section>

    {/* ── [A] VALUE HOOK INTRO ── */}
    <section class="value-intro" id="intro" data-reveal>
      <p class="value-intro__hook">{content.introHook}</p>

      <div class="value-intro__value-box">
        <h2 class="value-intro__value-title">{hValueBox}</h2>
        <ul class="value-intro__bullets">
          {content.introBullets.map(b => <li>{b}</li>)}
        </ul>
      </div>

      <div class="value-intro__teaser">
        <p>{content.introTeaser}</p>
      </div>
    </section>

    {/* ── [B-1] 3분 프롤로그 ── */}
    <section class="story-section" id="prologue" data-reveal>
      <h2 class="story-section__heading">{content.prologueTitle}</h2>
      <div class="story-section__body">
        <Fragment set:html={content.prologue} />
      </div>
    </section>

    {/* ── [B-2] 장면 1: 선택의 순간 ── */}
    <section class="story-section" id="scene1" data-reveal>
      <h2 class="story-section__heading">{content.scene1Title}</h2>
      <div class="story-section__body">
        <Fragment set:html={content.scene1} />
      </div>
    </section>

    {/* ── [B-3] 장면 2: 첫인상 디테일 ── */}
    <section class="story-section" id="scene2" data-reveal>
      <h2 class="story-section__heading">{content.scene2Title}</h2>
      <div class="story-section__body">
        <Fragment set:html={content.scene2} />
      </div>
    </section>

    {/* ── Extra: Tip Section ── */}
    <section class="story-section" data-reveal>
      <div class="story-section__body story-section__extra">
        <Fragment set:html={content.tipSection} />
      </div>
    </section>

    {/* ── Extra: Dialogue / Twist Section ── */}
    <section class="story-section" data-reveal>
      <div class="story-section__body story-section__extra">
        <Fragment set:html={content.dialogueSection} />
      </div>
    </section>

    {/* ── [2] Practical Guide ── */}
    <section class="detail-section" data-reveal>
      <h2 class="detail-section__heading">{hGuide}</h2>
      <div class="detail-table-wrap">
        <table class="detail-table">
          <tbody>
            {guideRows.map(row => (
              <tr>
                <th>{row.label}</th>
                <td>{row.value}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </section>

    {/* ── [B-5] 처음 가는 사람 체크리스트 ── */}
    <section class="detail-section" id="checklist" data-reveal>
      <h2 class="detail-section__heading">{content.checklistTitle}</h2>
      <ul class="checklist-list">
        {content.checklist.map(item => (
          <li class="checklist-list__item">
            <span class="checklist-list__icon" aria-hidden="true">&#10003;</span>
            <span>{item}</span>
          </li>
        ))}
      </ul>
    </section>

    {/* ── [QP] Quick Plan ── */}
    <section class="detail-section quick-plan" id="quick-plan" data-reveal>
      <h2 class="detail-section__heading">{hQuickPlan}</h2>
      <div class="quick-plan__table-wrap">
        <table class="detail-table">
          <thead>
            <tr>
              <th>{venue.name} 항목</th>
              <th>선택 A</th>
              <th>선택 B</th>
            </tr>
          </thead>
          <tbody>
            {content.quickPlan.decisionTable.map(row => (
              <tr>
                <th>{row.label}</th>
                <td>{row.optionA}</td>
                <td>{row.optionB}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      <h3 class="quick-plan__sub">{hScenarios}</h3>
      <div class="quick-plan__scenarios">
        {content.quickPlan.scenarios.map(s => (
          <div class="quick-plan__scenario">
            <strong>{s.title}</strong>
            <p>{s.desc}</p>
          </div>
        ))}
      </div>

      <p class="quick-plan__cost-note">{content.quickPlan.costNote}</p>
    </section>

    {/* ── [B-6] 실전 Q&A ── */}
    <FAQ items={content.faqItems} title={`${venue.name} Q&A`} />

    {/* ── [5] Trust Block ── */}
    <TrustBlock storeName={venue.name} variant={idx} />

    {/* ── [B-7] 마무리(결론) ── */}
    <section class="story-section detail-bottom-cta" id="bottom-cta" data-reveal>
      <h2 class="story-section__heading">{content.outroTitle}</h2>
      <div class="story-section__body">
        <Fragment set:html={content.outro} />
      </div>
      <div class="story-section__ctas">
        <a href={mapUrl} class="btn btn--primary" target="_blank" rel="noopener noreferrer">{venue.name} 약도 확인</a>
        <a href="/" class="btn btn--outline" target="_blank" rel="noopener noreferrer">다른 {catFullLabel} 살펴보기</a>
      </div>
    </section>

    {/* ── [7] Related Venues ── */}
    {relatedVenues.length > 0 && (
      <section class="detail-section" data-reveal>
        <h2 class="detail-section__heading">{hRelated}</h2>
        <div class="detail-related">
          {relatedVenues.map((v: any) => (
            <a
              href={venueDetailPath(v)}
              class="detail-related__link"
              target="_blank"
              rel="noopener noreferrer"
            >
              <strong>{v.name}</strong>
              <span>{v.district}</span>
            </a>
          ))}
        </div>
      </section>
    )}

  </main>
</BaseLayout>

<style is:global>
/* ═══ Detail Page — Dynamic Template Styles ═══ */
/* Using is:global so styles apply to set:html content (no data-astro-cid) */

/* ── Reading Progress Bar ── */
.reading-progress {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 3px;
  background: transparent;
  z-index: 9999;
  pointer-events: none;
}
.reading-progress__bar {
  height: 100%;
  width: 0%;
  background: var(--c-accent, #c8a86e);
  transition: width 80ms linear;
}

/* ── Reading Meta (time + nav) ── */
.detail-page .reading-meta {
  margin: 0 auto var(--sp-lg);
  padding: var(--sp-md) 0;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  gap: var(--sp-sm) var(--sp-lg);
}
.detail-page .reading-meta__time {
  font-size: var(--t-small);
  color: var(--c-muted);
  background: var(--c-bg-section);
  padding: 4px 12px;
  border-radius: 999px;
  white-space: nowrap;
}
.detail-page .reading-meta__nav {
  display: flex;
  flex-wrap: wrap;
  gap: var(--sp-xs);
}
.detail-page .reading-meta__link {
  font-size: var(--t-caption);
  color: var(--c-text-soft);
  text-decoration: none;
  padding: 4px 10px;
  border: 1px solid var(--c-border);
  border-radius: 999px;
  transition: all .15s;
}
.detail-page .reading-meta__link:hover {
  background: var(--c-accent-soft);
  border-color: var(--c-accent);
  color: var(--c-accent-text);
  text-decoration: none;
}

/* ── Value Hook Intro ── */
.detail-page .value-intro {
  margin: 0 auto var(--section-gap);
  padding: 0;
  text-align: center;
}
.detail-page .value-intro__hook {
  font-family: var(--font-display);
  font-size: var(--t-h3);
  line-height: var(--lh-body);
  color: var(--c-text);
  margin-bottom: var(--sp-lg);
  padding: var(--sp-md) var(--sp-lg);
  background: var(--c-bg-warm);
  border-radius: var(--r-md);
  border-top: 3px solid var(--c-accent);
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}
.detail-page .value-intro__value-box {
  background: var(--c-bg-section);
  border-radius: var(--r-md);
  padding: var(--sp-lg);
  margin-bottom: var(--sp-lg);
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
  text-align: left;
}
.detail-page .value-intro__value-title {
  font-size: var(--t-body);
  font-weight: 700;
  margin-bottom: var(--sp-sm);
  color: var(--c-text);
  text-align: center;
}
.detail-page .value-intro__bullets {
  list-style: none;
  padding: 0;
  margin: 0;
}
.detail-page .value-intro__bullets li {
  position: relative;
  padding-left: 20px;
  margin-bottom: var(--sp-xs);
  font-size: var(--t-body);
  line-height: var(--lh-body);
  color: var(--c-text-soft);
}
.detail-page .value-intro__bullets li::before {
  content: '→';
  position: absolute;
  left: 0;
  color: var(--c-accent);
  font-weight: 700;
}
.detail-page .value-intro__teaser {
  background: var(--c-bg-warm);
  border-radius: var(--r-md);
  padding: var(--sp-lg);
  font-style: italic;
  color: var(--c-text-soft);
  line-height: var(--lh-body);
  border-top: 2px solid var(--c-accent-soft, rgba(200,168,110,.3));
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}

/* ── Story Sections (set:html content) ── */
.detail-page .story-section {
  margin: 0 auto var(--section-gap);
  padding: 0;
}
.detail-page .story-section__heading {
  font-family: var(--font-display);
  font-size: var(--t-h2);
  line-height: var(--lh-heading);
  color: var(--c-navy);
  margin-bottom: var(--sp-lg);
  padding-bottom: var(--sp-sm);
  border-bottom: 2px solid var(--c-accent-soft, rgba(200,168,110,.2));
  text-align: center;
}
.detail-page .story-section__body {
  font-size: var(--t-body);
  line-height: var(--lh-body);
  color: var(--c-text-soft);
  max-width: 68ch;
  margin-left: auto;
  margin-right: auto;
}
.detail-page .story-section__body p {
  margin-bottom: var(--sp-md);
}
.detail-page .story-section__body h3 {
  font-family: var(--font-display);
  font-size: var(--t-h3);
  color: var(--c-navy);
  margin-top: var(--sp-xl);
  margin-bottom: var(--sp-md);
  text-align: center;
}
.detail-page .story-section__body .dialogue {
  background: var(--c-bg-section);
  padding: var(--sp-md) var(--sp-lg);
  border-radius: var(--r-md);
  font-style: italic;
  margin: var(--sp-lg) auto;
  border-top: 3px solid var(--c-accent);
  text-align: center;
  max-width: 400px;
}
.detail-page .story-section__ctas {
  display: flex;
  flex-wrap: wrap;
  gap: var(--sp-sm);
  margin-top: var(--sp-xl);
  justify-content: center;
}

/* ── Checklist ── */
.detail-page .checklist-list {
  list-style: none;
  padding: 0;
  margin: 0 auto;
  max-width: var(--max-narrow, 720px);
}
.detail-page .checklist-list__item {
  display: flex;
  align-items: flex-start;
  gap: var(--sp-sm);
  padding: var(--sp-sm) 0;
  border-bottom: 1px solid var(--c-border-light);
  font-size: var(--t-body);
  line-height: var(--lh-body);
  color: var(--c-text-soft);
}
.detail-page .checklist-list__icon {
  flex-shrink: 0;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--c-accent-soft);
  color: var(--c-accent-text);
  border-radius: 50%;
  font-size: 12px;
  font-weight: 700;
  margin-top: 3px;
}

/* ── AI Summary Block ── */
.detail-page .ai-summary {
  margin: 0 auto var(--section-gap);
  padding: var(--sp-lg);
  background: var(--c-bg-section);
  border-radius: var(--r-md, 12px);
  border-top: 4px solid var(--c-accent);
  max-width: 600px;
}
.detail-page .ai-summary__title {
  font-family: var(--font-display);
  font-size: var(--t-h3);
  color: var(--c-navy);
  margin-bottom: var(--sp-md);
  line-height: var(--lh-heading);
  text-align: center;
}
.detail-page .ai-summary__list {
  list-style: none;
  padding: 0;
  margin: 0;
  text-align: left;
}
.detail-page .ai-summary__list li {
  position: relative;
  padding-left: 22px;
  margin-bottom: var(--sp-xs);
  font-size: var(--t-body);
  line-height: var(--lh-body);
  color: var(--c-text-soft);
}
.detail-page .ai-summary__list li::before {
  content: '•';
  position: absolute;
  left: 6px;
  color: var(--c-accent);
  font-weight: 700;
  font-size: 1.1em;
}

/* ── Quick Plan ── */
.detail-page .quick-plan__table-wrap {
  overflow-x: auto;
  margin-bottom: var(--sp-lg);
}
.detail-page .quick-plan__sub {
  font-family: var(--font-display);
  font-size: var(--t-h3);
  color: var(--c-navy);
  margin-bottom: var(--sp-md);
  text-align: center;
}
.detail-page .quick-plan__scenarios {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--sp-sm);
  margin-bottom: var(--sp-lg);
}
.detail-page .quick-plan__scenario {
  background: var(--c-bg-section);
  border: 1px solid var(--c-border-light);
  border-radius: var(--r-md, 12px);
  padding: var(--sp-md);
}
.detail-page .quick-plan__scenario strong {
  display: block;
  color: var(--c-navy);
  margin-bottom: var(--sp-xs);
  font-size: var(--t-body);
}
.detail-page .quick-plan__scenario p {
  margin: 0;
  font-size: var(--t-small);
  line-height: var(--lh-body);
  color: var(--c-text-soft);
}
.detail-page .quick-plan__cost-note {
  font-size: var(--t-small);
  color: var(--c-muted);
  font-style: italic;
  line-height: var(--lh-body);
  padding: var(--sp-sm) var(--sp-md);
  background: var(--c-bg-warm);
  border-radius: var(--r-sm, 8px);
  text-align: center;
}

/* ── Detail Hero — Enhanced ── */
.detail-page .detail-hero {
  text-align: center;
  padding: var(--sp-xl) 0 var(--sp-lg);
}
.detail-page .detail-hero__figure {
  display: flex;
  justify-content: center;
  margin: 0 auto var(--sp-lg);
  max-width: 480px;
}
.detail-page .detail-hero__figure img {
  width: 100%;
  max-width: 480px;
  aspect-ratio: 1 / 1;
  object-fit: cover;
  border-radius: 18px;
  box-shadow: 0 8px 32px rgba(15, 23, 42, 0.10);
}
.detail-page .detail-hero__title {
  font-family: var(--font-display);
  font-size: var(--t-h1);
  font-weight: 700;
  line-height: 1.3;
  color: var(--c-navy);
  margin-bottom: var(--sp-sm);
}
.detail-page .detail-hero__meta {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
  gap: 4px 6px;
  font-size: var(--t-small);
  color: var(--c-muted);
  margin-bottom: var(--sp-lg);
}
.detail-page .detail-hero__ctas {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: var(--sp-sm);
}

/* ── Detail Hero Intro ── */
.detail-page .detail-hero-intro {
  padding: 0 0 var(--sp-lg);
}
.detail-page .detail-hero-intro__tagline {
  font-family: var(--font-display);
  font-size: var(--t-h3);
  font-style: italic;
  color: var(--c-text-soft);
  line-height: var(--lh-body);
  margin-bottom: var(--sp-lg);
  text-align: center;
}

/* ── Mobile responsive ── */
@media (max-width: 599px) {
  .detail-page .detail-hero__figure { max-width: 100%; }
  .detail-page .detail-hero__figure img { border-radius: 14px; }
  .detail-page .detail-hero__ctas { flex-direction: column; }
  .detail-page .detail-hero__ctas .btn { width: 100%; text-align: center; }
}
</style>

<script>
  // Reading progress bar
  const bar = document.getElementById('reading-progress-bar');
  if (bar) {
    const update = () => {
      const scrollTop = window.scrollY;
      const docHeight = document.documentElement.scrollHeight - window.innerHeight;
      if (docHeight > 0) {
        const pct = Math.min(100, (scrollTop / docHeight) * 100);
        bar.style.width = pct + '%';
      }
    };
    window.addEventListener('scroll', update, { passive: true });
    update();
  }
</script>
